<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>小甲哥の垃圾工厂</title><link>https://alecthw.github.io/</link><description>Recent content on 小甲哥の垃圾工厂</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="https://alecthw.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>机场/梯子推荐</title><link>https://alecthw.github.io/p/airport-recommend/</link><pubDate>Mon, 23 Dec 2024 09:24:13 +0800</pubDate><guid>https://alecthw.github.io/p/airport-recommend/</guid><description>&lt;img src="https://alecthw.github.io/p/airport-recommend/cover.jpg" alt="Featured image of post 机场/梯子推荐" />&lt;p>分类推荐，每种就推荐两三个，供有不同需求的人参考。&lt;/p>
&lt;p>极简总结：&lt;/p>
&lt;p>&lt;strong>优惠码适时更新，请关注：&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>🔥&lt;/th>
&lt;th>个人需求&lt;/th>
&lt;th>机场名称&lt;/th>
&lt;th>机场特点&lt;/th>
&lt;th>传送门&lt;/th>
&lt;th>优惠码&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>🔥&lt;/td>
&lt;td>高性价比，小众新兴&lt;/td>
&lt;td>五树云机场（原小米梯子）&lt;/td>
&lt;td>新兴机场，2.5G 速率，价格实惠，性价比高，值得一试&lt;/td>
&lt;td>&lt;a class="link" href="https://xminb.xiaomiaff.cc/register.html?invitecode=DBQFuexi" target="_blank" rel="noopener"
>🚀直达&lt;/a>&lt;/td>
&lt;td>9折：2025s9&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>🔥&lt;/td>
&lt;td>尝鲜偶用，预算较低&lt;/td>
&lt;td>一元机场&lt;/td>
&lt;td>一个月不到 1 块钱，老牌廉价机场，推荐作为备用防失联&lt;/td>
&lt;td>&lt;a class="link" href="https://xn--4gq62f52gdss.ink/#/register?code=QFTTlbYU" target="_blank" rel="noopener"
>🚀直达&lt;/a>&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>🔥&lt;/td>
&lt;td>重度依赖，长期稳定&lt;/td>
&lt;td>TAG&lt;/td>
&lt;td>全球 250+ 节点、99+ 流媒体解锁，覆盖地区最广的机场，虽贵但好用&lt;/td>
&lt;td>&lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>🚀直达&lt;/a>&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>🔥&lt;/td>
&lt;td>喜欢看剧，自带Emby&lt;/td>
&lt;td>TLS&lt;/td>
&lt;td>主打 Emby， 有 4K 资源，支持直连和 Infuse，全球 50+ 节点&lt;/td>
&lt;td>&lt;a class="link" href="https://tls.wiki/index.php#/register?code=ojo2nVBG" target="_blank" rel="noopener"
>🚀直达&lt;/a>&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>流媒体解锁都支持的。当前强烈推荐&lt;strong>五树云机场（原小米梯子）&lt;/strong>，稳定性好，性价比非常高！&lt;/p>
&lt;p>目录：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="#%e7%89%b9%e5%88%ab%e6%8e%a8%e8%8d%90" >特别推荐&lt;/a>
&lt;ul>
&lt;li>&lt;a class="link" href="#%e4%ba%94%e6%a0%91%e4%ba%91%e6%9c%ba%e5%9c%ba%e5%8e%9f%e5%b0%8f%e7%b1%b3%e6%a2%af%e5%ad%90--%e6%80%a7%e4%bb%b7%e6%af%94%e8%87%b3%e9%ab%98%e4%b9%8b%e9%80%89" >🔥五树云机场（原小米梯子） —— 性价比至高之选&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="#%e8%bd%bb%e5%ba%a6%e4%bd%bf%e7%94%a8" >轻度使用&lt;/a>
&lt;ul>
&lt;li>&lt;a class="link" href="#%e4%b8%80%e5%85%83%e6%9c%ba%e5%9c%ba--%e4%b8%80%e4%b8%aa%e6%9c%881%e5%9d%97%e9%92%b1" >🔥一元机场 —— 一个月1块钱&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="#%e4%b8%89%e5%88%86%e6%9c%ba%e5%9c%ba--%e4%b8%80%e5%a4%a93%e5%88%86%e9%92%b1" >三分机场 —— 一天3分钱&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="#%e4%b8%ad%e5%ba%a6%e4%bd%bf%e7%94%a8" >中度使用&lt;/a>
&lt;ul>
&lt;li>&lt;a class="link" href="#%e5%b0%8f%e9%b8%a1%e5%bf%ab%e8%b7%91--%e4%bc%98%e8%b4%a8%e6%80%a7%e4%bb%b7%e6%af%94%e6%9c%ba%e5%9c%ba" >🔥小鸡快跑 —— 优质性价比机场&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="#%e9%87%8d%e5%ba%a6%e4%bd%bf%e7%94%a8" >重度使用&lt;/a>
&lt;ul>
&lt;li>&lt;a class="link" href="#tag--%e6%9c%ba%e5%9c%ba%e4%b8%ad%e7%9a%84%e6%8e%92%e5%a4%b4%e5%85%b5" >🔥TAG —— 机场中的排头兵&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="#nexitally--%e8%80%81%e7%89%8c%e6%9c%ba%e5%9c%ba%e4%bd%a9%e5%a5%87%e5%ae%b6%e5%a5%b6%e6%98%94" >Nexitally —— 老牌机场佩奇家、奶昔&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="#%e7%89%b9%e8%89%b2%e6%9c%ba%e5%9c%ba" >特色机场&lt;/a>
&lt;ul>
&lt;li>&lt;a class="link" href="#tls--emby-4k" >TLS —— Emby 4K&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="#%e6%9c%80%e5%90%8e" >最后&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="特别推荐">特别推荐
&lt;/h2>&lt;p>个人认为非常好用且性价比贼高的机场。&lt;/p>
&lt;h3 id="五树云机场原小米梯子--性价比至高之选">🔥五树云机场（原小米梯子） —— 性价比至高之选
&lt;/h3>&lt;p>9折优惠码：2025s9&lt;/p>
&lt;p>官网：&lt;a class="link" href="https://xminb.xiaomiaff.cc/register.html?invitecode=DBQFuexi" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>&lt;/p>
&lt;p>协议：&lt;code>Trojan&lt;/code>&lt;/p>
&lt;p>特点：新兴的一家全中转 IPLC 翻墙机场，全节点 IPLC 专线，后端负载均衡、多种方式落地，2.5G速率，确保稳定性。不限速不限连接数！如果有特别需求，还可以私人定制。&lt;/p>
&lt;p>ChatGPT/OpenAI/TikTok 解锁，Netflix/Disney+/Youtube/PCR等常规流媒体已解锁。&lt;/p>
&lt;p>节点：香港、台湾、新加坡、日本、韩国、泰国、美国、法国、加拿大、马来西亚、英国、阿根廷、巴西等。&lt;/p>
&lt;p>价格适中，稳定性好，地区节点覆盖多。不限速不限连接数，适合多设备、全家共同使用。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/wushuyun.jpg"
width="1470"
height="717"
srcset="https://alecthw.github.io/p/airport-recommend/wushuyun_hu_b45d677ada44422a.jpg 480w, https://alecthw.github.io/p/airport-recommend/wushuyun_hu_803531e233b19c32.jpg 1024w"
loading="lazy"
alt="五树云机场套餐"
class="gallery-image"
data-flex-grow="205"
data-flex-basis="492px"
>&lt;/p>
&lt;p>测速如下：&lt;/p>
&lt;p>机场尚在优化调整中，优化完成后都能跑满速，测速图暂做参考，后续会刷新。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/xiaomitizi-speed.png"
width="2702"
height="3018"
srcset="https://alecthw.github.io/p/airport-recommend/xiaomitizi-speed_hu_ca6ffecd0bff3a03.png 480w, https://alecthw.github.io/p/airport-recommend/xiaomitizi-speed_hu_9a103a3d39f8054b.png 1024w"
loading="lazy"
alt="五树云机场测速"
class="gallery-image"
data-flex-grow="89"
data-flex-basis="214px"
>&lt;/p>
&lt;h2 id="轻度使用">轻度使用
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>预算低&lt;/strong>，舍不得在这方面大支出&lt;/li>
&lt;li>备用机场防失联&lt;/li>
&lt;li>海淘、谷歌&lt;/li>
&lt;li>偶尔看看 Youtube 等视频&lt;/li>
&lt;li>Telegram 聊天&lt;/li>
&lt;li>基本没有速度和时延要求&lt;/li>
&lt;/ul>
&lt;h3 id="一元机场--一个月1块钱">🔥一元机场 —— 一个月1块钱
&lt;/h3>&lt;p>官网：&lt;a class="link" href="https://xn--4gq62f52gdss.ink/#/register?code=QFTTlbYU" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>&lt;/p>
&lt;p>协议：&lt;code>Trojan&lt;/code>&lt;/p>
&lt;p>特点：廉价，流量高，速度还行，但是不太稳定。&lt;/p>
&lt;p>有点小名气的低价机场，主打的就是一个价格低。晚高峰会有点卡，稳定性也不算高，不过 12CNY/Year、20CNY/2Year 的价格要什么自行车，主要是速度也还行，解锁 Netflix 和 Disney+，美国节点解锁 ChatGPT。&lt;/p>
&lt;p>&lt;strong>注意:&lt;/strong> 传家宝套餐由原来每月 &lt;code>500G&lt;/code>，变成每月 &lt;code>50G&lt;/code> 了，此时可以优先考虑[三分机场](#三分机场 —— 一天3分钱)了~~&lt;/p>
&lt;p>他家就买这个传家宝套餐就行了。至于俩稍微贵点的高流量套餐，可以拿来当二道贩子，封装个 APP 卖钱😜。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/one-dollar.jpg"
width="363"
height="538"
srcset="https://alecthw.github.io/p/airport-recommend/one-dollar_hu_eee0b8be80500c18.jpg 480w, https://alecthw.github.io/p/airport-recommend/one-dollar_hu_39a6843d0f48673f.jpg 1024w"
loading="lazy"
alt="一元机场套餐"
class="gallery-image"
data-flex-grow="67"
data-flex-basis="161px"
>&lt;/p>
&lt;p>节点以香港、日本、美国、新加坡为主，偶尔会出现土耳其等特别的节点。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/one-dollar-speed.jpg"
width="2504"
height="2206"
srcset="https://alecthw.github.io/p/airport-recommend/one-dollar-speed_hu_39eb48af8d1fe584.jpg 480w, https://alecthw.github.io/p/airport-recommend/one-dollar-speed_hu_9ff8574a013a24cd.jpg 1024w"
loading="lazy"
alt="一元机场测速（来自网络）"
class="gallery-image"
data-flex-grow="113"
data-flex-basis="272px"
>&lt;/p>
&lt;h3 id="三分机场--一天3分钱">三分机场 —— 一天3分钱
&lt;/h3>&lt;p>优惠码（截止2025年04月05日，注意关注官网公告）：&lt;/p>
&lt;ul>
&lt;li>9折：&lt;del>neqatgho&lt;/del>&lt;/li>
&lt;/ul>
&lt;p>官网1：&lt;a class="link" href="https://panel.sanfen.icu/register?code=FKnu6Hkg" target="_blank" rel="noopener"
>👉链接（最新可直连）🚀&lt;/a>
官网2：&lt;a class="link" href="https://ca.sanfen.me/#/register?code=FKnu6Hkg" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>
官网3：&lt;a class="link" href="https://hk.sanfen.cc/#/register?code=FKnu6Hkg" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>&lt;/p>
&lt;p>协议：&lt;code>VMESS&lt;/code>&lt;/p>
&lt;p>&lt;strong>2024年6月5日起，限时供应 9.5CNY/Year 每月 200G 直连套餐！！！目前仍可购买。&lt;/strong>&lt;/p>
&lt;p>特点：廉价，流量较少，速度还行，稳定性一般，相对小众一点。&lt;/p>
&lt;p>和上面类似，也是靠低价起家的，后来也推出了中转套餐。&lt;/p>
&lt;p>注意：最实惠的套餐目前就是 &lt;code>8CNY/Quarter 每月 200G&lt;/code> 了。&lt;/p>
&lt;p>特别注意，直连套餐里有个小字说明：&lt;code>福建福州、泉州、湖南和河南大部分地区此套餐可能无法使&lt;/code>，这些地区的小伙伴谨慎购买。&lt;/p>
&lt;p>中转套餐就不太推荐了，最低 9.9CNY/Month 80G，这个价格的话更推荐上面的 &lt;a class="link" href="https://xminb.xiaomiaff.cc/register.html?invitecode=DBQFuexi" target="_blank" rel="noopener"
>五树云&lt;/a> 了。&lt;/p>
&lt;p>目前节点包括香港、日本、美国、新加坡、台湾。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/three-cents-2.png"
width="1042"
height="1050"
srcset="https://alecthw.github.io/p/airport-recommend/three-cents-2_hu_20c688a440ec88e0.png 480w, https://alecthw.github.io/p/airport-recommend/three-cents-2_hu_de43d00503ee09b2.png 1024w"
loading="lazy"
alt="三分机场套餐2"
class="gallery-image"
data-flex-grow="99"
data-flex-basis="238px"
>&lt;/p>
&lt;p>官方频道测速如下：&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/three-cents-speed.jpg"
width="1280"
height="531"
srcset="https://alecthw.github.io/p/airport-recommend/three-cents-speed_hu_d97f2f08d29e7ca1.jpg 480w, https://alecthw.github.io/p/airport-recommend/three-cents-speed_hu_6943eb4704816df8.jpg 1024w"
loading="lazy"
alt="三分机场测速"
class="gallery-image"
data-flex-grow="241"
data-flex-basis="578px"
>&lt;/p>
&lt;h2 id="中度使用">中度使用
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>预算有限&lt;/strong>，愿意适当的为科学上网付费&lt;/li>
&lt;li>时不时看看 Youtube、Netflix、Disney+ 等流媒体&lt;/li>
&lt;li>Telegram 聊天，偶尔看看视频&lt;/li>
&lt;li>速度和时延不是特别敏感&lt;/li>
&lt;/ul>
&lt;h3 id="小鸡快跑--优质性价比机场">🔥小鸡快跑 —— 优质性价比机场
&lt;/h3>&lt;p>优惠码（截止2025年01月07日，注意关注官网公告）：&lt;/p>
&lt;ul>
&lt;li>&lt;del>月付套餐9折：20259&lt;/del>&lt;/li>
&lt;li>&lt;del>季付以上套餐8折：20258&lt;/del>&lt;/li>
&lt;li>&lt;del>60G年付套餐9折: 20259n&lt;/del>&lt;/li>
&lt;/ul>
&lt;p>官网：&lt;a class="link" href="https://ccv2.xiaojikp.pro/#/register?code=tqB3FCup" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>&lt;/p>
&lt;p>官网2：&lt;a class="link" href="https://xiaojiv2.xiaojicf.com/#/register?invitecode=tqB3FCup" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>&lt;/p>
&lt;p>协议：&lt;code>Trojan&lt;/code>&lt;/p>
&lt;p>特点：一家性价比翻墙机场，全节点 IPLC 专线，负载均衡，带宽冗余超过 2Gbps，测速最高能达 260MB/s，有不错的流媒体和 ChatGPT 解锁。&lt;/p>
&lt;p>相对小众一点，价格适中，与几个大机场相比可以说是低价，重点是速度超越绝大多数机场，值得一试。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/chickenrun.jpg"
width="1682"
height="1062"
srcset="https://alecthw.github.io/p/airport-recommend/chickenrun_hu_96abff9219f85ba0.jpg 480w, https://alecthw.github.io/p/airport-recommend/chickenrun_hu_b8f4731e4d99c9fc.jpg 1024w"
loading="lazy"
alt="小鸡快跑套餐"
class="gallery-image"
data-flex-grow="158"
data-flex-basis="380px"
>&lt;/p>
&lt;p>测速如下：&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/chickenrun-speed.jpg"
width="2616"
height="2844"
srcset="https://alecthw.github.io/p/airport-recommend/chickenrun-speed_hu_bbabcdfe19f33783.jpg 480w, https://alecthw.github.io/p/airport-recommend/chickenrun-speed_hu_9084520a64a9502d.jpg 1024w"
loading="lazy"
alt="小鸡快跑测速"
class="gallery-image"
data-flex-grow="91"
data-flex-basis="220px"
>&lt;/p>
&lt;h2 id="重度使用">重度使用
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>不在乎价格&lt;/strong>&lt;/li>
&lt;li>Netflix、Disney+ 等流媒体重度依赖&lt;/li>
&lt;li>长期看不能直连的 Emby 公益服&lt;/li>
&lt;li>Telegram 上看视频&lt;/li>
&lt;li>办公强依赖&lt;/li>
&lt;li>追求&lt;strong>稳定性&lt;/strong>&lt;/li>
&lt;li>&lt;strong>高速&lt;/strong>和&lt;em>&lt;strong>低时延&lt;/strong>&lt;/em>要求&lt;/li>
&lt;/ul>
&lt;h3 id="tag--机场中的排头兵">🔥TAG —— 机场中的排头兵
&lt;/h3>&lt;p>官网：&lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>&lt;/p>
&lt;p>协议：&lt;code>Shadowsocks&lt;/code>&lt;/p>
&lt;p>特点：比较贵，节点覆盖面广，速度较快，稳定。有&lt;strong>游戏专用节点&lt;/strong>，游戏加速效果不错。&lt;/p>
&lt;p>&lt;strong>特别提醒：该机场禁用了 22 端口，这点对开发者不太友好，尤其影响 Git SSH，如果你是开发者则慎重购买。&lt;/strong>&lt;/p>
&lt;p>全球 250+ 节点、99+ 流媒体解锁，线路是全 BGP-IEPL 广港 + BGP-IEPL 沪日中转，全球 90+ 国家地区节点，&lt;strong>地区覆盖范围是最广的&lt;/strong>，什么奇奇怪怪的国家地区都有，就连南极、美国星链也有。想象以下，发帖回帖，地区显示南极😁！&lt;/p>
&lt;p>同样的 Netflix、Disney+ 等流媒体，该解锁的都解锁了，ChatGPT 也是。&lt;/p>
&lt;p>他家有一个特别套餐，154CNY/Year，总共 200G 流量，用作备用防失联特别好，或者需要一些罕见地区的时候。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/tag-sp.png"
width="348"
height="572"
srcset="https://alecthw.github.io/p/airport-recommend/tag-sp_hu_ce851ee91625ecfe.png 480w, https://alecthw.github.io/p/airport-recommend/tag-sp_hu_5e29e57f01515959.png 1024w"
loading="lazy"
alt="TAG 特殊套餐"
class="gallery-image"
data-flex-grow="60"
data-flex-basis="146px"
>&lt;/p>
&lt;p>其他套餐价格如下：&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/tag.png"
width="2211"
height="1167"
srcset="https://alecthw.github.io/p/airport-recommend/tag_hu_d0a38476185d484c.png 480w, https://alecthw.github.io/p/airport-recommend/tag_hu_dde18d917cdf91ff.png 1024w"
loading="lazy"
alt="TAG套餐"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="454px"
>&lt;/p>
&lt;p>电信测速，可以参考下。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/tag-speed.png"
width="4591"
height="15256"
srcset="https://alecthw.github.io/p/airport-recommend/tag-speed_hu_dece172addffdc41.png 480w, https://alecthw.github.io/p/airport-recommend/tag-speed_hu_807007f8bff67d70.png 1024w"
loading="lazy"
alt="TAG测速"
class="gallery-image"
data-flex-grow="30"
data-flex-basis="72px"
>&lt;/p>
&lt;h3 id="nexitally--老牌机场佩奇家奶昔">Nexitally —— 老牌机场佩奇家、奶昔
&lt;/h3>&lt;p>官网：&lt;a class="link" href="https://naiixi.com/signupbyemail.aspx?MemberCode=5753cb7ae8b241a0bf7a55ae3330f8bc20210411040001" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>&lt;/p>
&lt;p>协议：&lt;code>Shadowsocks&lt;/code>, &lt;code>Trojan&lt;/code>&lt;/p>
&lt;p>特点：昂贵，稳定，流量还行，速度快，晚高峰也稳定有速度。出问题的时候，也是自己把自己折腾挂了。&lt;/p>
&lt;p>官网打不开的话先挂个别的代理。&lt;/p>
&lt;p>&lt;a class="link" href="https://www.duyaoss.com/" target="_blank" rel="noopener"
>毒药&lt;/a>推荐中的第一名，佩奇家中转线路的高端机场，稳定性和速度都非常错，价格高昂，但是对于追求稳定性的用户也还能接受。&lt;/p>
&lt;p>这也是我个人主要使用的，已经使用三年了，目前应该是第四年。&lt;/p>
&lt;p>Netflix、Disney+ 等流媒体，该解锁的都解锁了，ChatGPT 也是可以正常用的。&lt;/p>
&lt;p>有自己的傻瓜客户端，可以登录后一键连接。&lt;/p>
&lt;p>套餐情况：&lt;/p>
&lt;ul>
&lt;li>Smart Access：每月 500G 流量，价格受汇率影响，约为 117CNY/Month，约 594CNY/Year，约 1102CNY/Year&lt;/li>
&lt;li>Smart Access Air：每月 200G 流量，价格是 Smart Access 的一半多点，但是&lt;code>限量提供，能不能买到看缘分，买到后可以一直续费&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/nexitally.png"
width="1537"
height="896"
srcset="https://alecthw.github.io/p/airport-recommend/nexitally_hu_83fc2fc7e70e1fc3.png 480w, https://alecthw.github.io/p/airport-recommend/nexitally_hu_ba48c8b545354114.png 1024w"
loading="lazy"
alt="Nexitally 套餐"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="411px"
>&lt;/p>
&lt;p>毒药的电信测速，可以参考下。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/nexitally-speed.png"
width="4490"
height="8238"
srcset="https://alecthw.github.io/p/airport-recommend/nexitally-speed_hu_508cd386aeed7890.png 480w, https://alecthw.github.io/p/airport-recommend/nexitally-speed_hu_fc1bf25e496d414b.png 1024w"
loading="lazy"
alt="Nexitally 测速（来自毒药）"
class="gallery-image"
data-flex-grow="54"
data-flex-basis="130px"
>&lt;/p>
&lt;h2 id="特色机场">特色机场
&lt;/h2>&lt;p>这类机场除了提供科学上网的节点之外，一般还附带一些别的服务，例如 Emby、Plex 之类的视频服务。&lt;/p>
&lt;h3 id="tls--emby-4k">TLS —— Emby 4K
&lt;/h3>&lt;ul>
&lt;li>&lt;del>全场8折优惠码：2025GO&lt;/del>&lt;/li>
&lt;/ul>
&lt;p>官网：&lt;a class="link" href="https://tls.wiki/index.php#/register?code=ojo2nVBG" target="_blank" rel="noopener"
>👉链接🚀&lt;/a>&lt;/p>
&lt;p>协议：&lt;code>Shadowsocks&lt;/code>&lt;/p>
&lt;p>特点：中高级套餐附带 Emby 且有 4K，价格适中，速度较快，相对稳定。&lt;code>PS: Emby 高清和4K均已恢复，可以冲！······&lt;/code>&lt;/p>
&lt;p>最大的特色是高级套餐附带 Emby 服务，提供了 4K 片源，并且直连 Emby 的速度也是不错的，不需要梯子就能直接看。影视库更新速度也挺快，最新电视剧集基本第二天就上了，基本可以替代国内视频平台。相对小众一点，客服态度也很好。&lt;/p>
&lt;p>套餐除了翻墙套餐送 Emby 外，也单独提供了 Emby 套餐。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/tls.png"
width="2025"
height="1316"
srcset="https://alecthw.github.io/p/airport-recommend/tls_hu_3a7b488858e40e5c.png 480w, https://alecthw.github.io/p/airport-recommend/tls_hu_9736ce16759d1e01.png 1024w"
loading="lazy"
alt="TLS 套餐"
class="gallery-image"
data-flex-grow="153"
data-flex-basis="369px"
>&lt;/p>
&lt;p>测速如下：&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/airport-recommend/tls-speed.png"
width="3212"
height="4062"
srcset="https://alecthw.github.io/p/airport-recommend/tls-speed_hu_696e286924af33e4.png 480w, https://alecthw.github.io/p/airport-recommend/tls-speed_hu_6664a604b4696584.png 1024w"
loading="lazy"
alt="TLS 测速（来自网络）"
class="gallery-image"
data-flex-grow="79"
data-flex-basis="189px"
>&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;p>对于刚接触科学上网的朋友，建议先买个廉价的梯子体验个把月，确认自己是否有科学上网的需求、以及科学上网的依赖度有多大，如果确实有需求再考虑换高价稳定的梯子。&lt;/p>
&lt;p>对于海淘的朋友，如果只看看商品不亲自购买，一元机场、三分机场这种完全够用，别信海淘群里那种倒卖的，说不定卖给你的就是这种。&lt;/p></description></item><item><title>AdGuardHome + mosdns + openclash 打造自由的家庭/办公室网络</title><link>https://alecthw.github.io/p/fuck-gfw/</link><pubDate>Sat, 25 Nov 2023 20:32:18 +0800</pubDate><guid>https://alecthw.github.io/p/fuck-gfw/</guid><description>&lt;img src="https://alecthw.github.io/p/fuck-gfw/cover.jpg" alt="Featured image of post AdGuardHome + mosdns + openclash 打造自由的家庭/办公室网络" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;p>👉 首先推广下自己编译的 OpenWrt &lt;strong>旁路由极简版&lt;/strong>，专为&lt;strong>旁路由&lt;/strong>而制作。 👍👍👍&lt;/p>
&lt;ul>
&lt;li>编译脚本以及个人修改的组件依赖全开源，Github Actions 在线编译，安全可靠无后门。&lt;/li>
&lt;li>基于 &lt;a class="link" href="https://github.com/coolsnowwolf/lede" target="_blank" rel="noopener"
>lede&lt;/a> 源码&lt;/li>
&lt;li>默认配置 DHCPv6 Client 接口 lan6。&lt;/li>
&lt;li>默认配置好了 AdGuardHome 、 mosdns 和 openclash （或 ssrp ）的搭配运行配置。&lt;/li>
&lt;li>openclash 预置 clash_meta 内核。&lt;/li>
&lt;li>mosdns 使用了 &lt;a class="link" href="https://github.com/alecthw/mosdns" target="_blank" rel="noopener"
>自己的修改版&lt;/a>，支持 MMDB GeoIP 匹配。&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>版本&lt;/th>
&lt;th>说明&lt;/th>
&lt;th style="text-align: center">下载地址&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>x86&lt;/td>
&lt;td>包含 ssrp 和 openclash，&lt;a class="link" href="https://github.com/alecthw/openwrt-actions/blob/master/user/lede-common-x86-amd64/README.md" target="_blank" rel="noopener"
>详细说明&lt;/a>&lt;/td>
&lt;td style="text-align: center">&lt;a class="link" href="https://github.com/alecthw/openwrt-actions/releases/tag/lede-common-x86-amd64" target="_blank" rel="noopener"
>下载&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>x86 openclash 专版&lt;/td>
&lt;td>仅包含 openclash，注意此固件默认不劫持 53 端口，&lt;a class="link" href="https://github.com/alecthw/openwrt-actions/blob/master/user/lede-openclash-x86-amd64/README.md" target="_blank" rel="noopener"
>详细说明&lt;/a>&lt;/td>
&lt;td style="text-align: center">&lt;a class="link" href="https://github.com/alecthw/openwrt-actions/releases/tag/lede-openclash-x86-amd64" target="_blank" rel="noopener"
>下载&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>r2s&lt;/td>
&lt;td>包含 ssrp 和 openclash，&lt;a class="link" href="https://github.com/alecthw/openwrt-actions/blob/master/user/lede-common-r2s-arm64/README.md" target="_blank" rel="noopener"
>详细说明&lt;/a>&lt;/td>
&lt;td style="text-align: center">&lt;a class="link" href="https://github.com/alecthw/openwrt-actions/releases/tag/lede-common-r2s-arm64" target="_blank" rel="noopener"
>下载&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>n1&lt;/td>
&lt;td>包含 ssrp 和 openclash，&lt;a class="link" href="https://github.com/alecthw/openwrt-actions/blob/master/user/lede-common-n1-arm64/README.md" target="_blank" rel="noopener"
>详细说明&lt;/a>&lt;/td>
&lt;td style="text-align: center">&lt;a class="link" href="https://github.com/alecthw/openwrt-actions/releases/tag/lede-common-n1-arm64" target="_blank" rel="noopener"
>下载&lt;/a>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>注意，旁路由固件默认未开启DHCP，旁路由固件默认未开启DHCP，旁路由固件默认未开启DHCP！&lt;/strong>&lt;/p>
&lt;p>&lt;strong>所以，如果不在控制台修改IP，请修改电脑的IP访问，然后可以在网页修改。&lt;/strong>&lt;/p>
&lt;h2 id="前言">前言
&lt;/h2>&lt;p>CN网络的阻断方式主要有两个部分：&lt;/p>
&lt;ul>
&lt;li>GFW 阻断&lt;/li>
&lt;li>DNS 污染&lt;/li>
&lt;/ul>
&lt;p>GFW 阻断就是我们常说的&lt;code>被墙了&lt;/code>，即使是DNS没有被污染，也无法访问到。&lt;/p>
&lt;p>DNS 污染即让你访问网站时，无法获得域名对应的IP地址，从而导致无法访问到网站。DNS 污染在移动宽带中尤为典型，即使自定义了DNS 服务器，也会被拦截污染。&lt;/p>
&lt;p>要实现科学上网，必须同时解决&lt;code>GFW 阻断&lt;/code>和&lt;code>DNS 污染&lt;/code>，并且两者配合以提高网络访问体验。&lt;/p>
&lt;p>代理中的DNS知识，可以参考 Sukka 的这篇文章&lt;a class="link" href="https://blog.skk.moe/post/what-happend-to-dns-in-proxy/" target="_blank" rel="noopener"
>《浅谈在代理环境中的 DNS 解析行为》&lt;/a>&lt;/p>
&lt;h3 id="路由器科学上网和终端科学上网的区别">路由器科学上网和终端科学上网的区别
&lt;/h3>&lt;p>路由器上配置透明代理，和在终端PC上直接通过客户端，最主要的区别是 DNS 解析。&lt;/p>
&lt;h4 id="pc终端上">PC终端上
&lt;/h4>&lt;p>通常有以下几个步骤&lt;/p>
&lt;ol>
&lt;li>启动客户端&lt;/li>
&lt;li>选择全局/规则模式&lt;/li>
&lt;li>配置系统代理（一般客户端自动配置），把科学上网客户端作为系统代理的上游代理服务器&lt;/li>
&lt;/ol>
&lt;p>第3步里的配置系统代理，通常有&lt;code>http&lt;/code>和&lt;code>sock5&lt;/code>两种。&lt;/p>
&lt;p>此时，打开浏览器访问一个网站：&lt;/p>
&lt;p>当使用&lt;code>http&lt;/code>代理时，浏览器不会在本地进行 DNS 解析，请求的域名会作为 http 报文的一部分直接发给代理服务器（科学上网客户端），DNS 完全在代理服务器（科学上网客户端）上处理。&lt;/p>
&lt;p>当使用&lt;code>sock5&lt;/code>代理时，&lt;code>sock5&lt;/code>支持UDP，DNS 解析会封装在&lt;code>sock5&lt;/code>之中，发给代理服务器（科学上网客户端）处理，浏览器拿到 IP 地址后，在发起连接。&lt;/p>
&lt;h4 id="路由器上配置透明代理">路由器上配置透明代理
&lt;/h4>&lt;p>此时，科学上网客户端运行在路由器上，PC 终端是看不见代理的，所以叫透明代理。PC 终端上，请求的发起的流程照旧，先进行 DNS 解析，拿到 IP 后再发起请求。&lt;/p>
&lt;p>在这种情况下，对于路由器上运行的科学上网客户端来说，域名和 IP 是两个请求，有的会内置 Mapping 机制（例如 Clash），用来还原 IP 到域名。&lt;/p>
&lt;p>这种情况下，优惠DNS配置就相对比较重要了，否则针对部署的CDN的网站不能做到最优访问。&lt;/p>
&lt;h2 id="正文开始配置--dns-优化">正文开始：配置 &amp;amp; DNS 优化
&lt;/h2>&lt;p>本文主要考虑的是自由的局域网环境，所以只介绍路由器上科学上网配置。&lt;/p>
&lt;p>首先分析下要实现的目标：&lt;/p>
&lt;ul>
&lt;li>双栈网络
&lt;ul>
&lt;li>国内网络使用 IPV4 &amp;amp; IPV6 双栈&lt;/li>
&lt;li>科学上网仅使用 IPV4&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>国内外分流&lt;/li>
&lt;li>DNS分流
&lt;ul>
&lt;li>国内域名由国内 DNS 服务器解析&lt;/li>
&lt;li>国外域名经过代理由国外 DNS 服务器&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="国内外和应用分流">国内外和应用分流
&lt;/h3>&lt;p>这个没啥好多说的，按文档配置规则就行。也可参考文末给出的示例配置。&lt;/p>
&lt;h3 id="dns-优化目标">DNS 优化目标
&lt;/h3>&lt;ul>
&lt;li>广告过滤：使用 AdGuardHome&lt;/li>
&lt;li>DNS分流：使用 mosdns
&lt;ul>
&lt;li>其中，境外网站屏蔽 IPV6 应答&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>如果使用 openclash，DNS 必须经过 clash 内核，以使 DNS 完成 IP &amp;lt;&amp;ndash;&amp;gt; Domain 的 mapping&lt;/li>
&lt;/ul>
&lt;p>PS: mosdns 使用 &lt;a class="link" href="https://github.com/alecthw/mosdns" target="_blank" rel="noopener"
>alecthw 修改版&lt;/a>，支持 MMDB GeoIP 匹配&lt;/p>
&lt;h3 id="多级-dns-级联">多级 DNS 级联
&lt;/h3>&lt;pre class="mermaid">flowchart LR
A[AdGuardHome, Port 53, no cache] -- 主要 --&amp;gt; B[openclash, Port 7874]
B --&amp;gt; C[mosdns, Port 5335]
A -- 备用\n防止 openclash 为运行时网络无法访问 --&amp;gt; C&lt;/pre>
&lt;p>配置过程如下：&lt;/p>
&lt;ul>
&lt;li>修改了 dnsmasq 的默认端口号，用 AdGuardHome 监听53端口作为默认的DNS解析。&lt;/li>
&lt;li>AdGuardHome 可以监控的各个终端的 DNS 请求，并使用广告过滤和管控功能。&lt;/li>
&lt;li>openclash 作为 AdGuardHome 的上游。&lt;/li>
&lt;li>mosdns 作为 AdGuardHome 的上游备用服务器。&lt;/li>
&lt;li>openclash 中&lt;code>本地 DNS 劫持&lt;/code>设置为&lt;code>停用&lt;/code>，当 openclash 运行时，openclash 作为 AdGuardHome 的上游主要服务器&lt;code>生效&lt;/code>。&lt;/li>
&lt;li>openclash 复写设置中，启用自定义上游 DNS 服务器，并指定 mosdns 为唯一上游。&lt;/li>
&lt;/ul>
&lt;p>如此一来，最终的 DNS 请求由 mosdns 发出，请求会经过 openclash 分流，按请求的 DNS 服务器直连或走代理。DNS 请求整个流程如下：&lt;/p>
&lt;pre class="mermaid">flowchart TB
A((电脑/手机\n浏览器)) -- DNS 请求 --&amp;gt; B[路由器\nAdGuardHome]
B --&amp;gt; C[路由器\nopenclash DNS]
C --&amp;gt; D[路由器\nmosdns]
D --&amp;gt; E[路由器\nopenclash Proxy Client]
E -- 国外 DNS 服务器\n屏蔽ipv6应答 --&amp;gt; F[服务器\nProxy Server]
E -- 国内 DNS 服务器 --&amp;gt; N(Internet)
F --&amp;gt; N&lt;/pre>
&lt;p>如此，便实现了&lt;/p>
&lt;ul>
&lt;li>AdGuardHome 的管控和广告过滤&lt;/li>
&lt;li>mosdns 分流 DNS，并屏蔽非中国大陆 IP 的 IPV6 应答&lt;/li>
&lt;li>DNS 经过 clash 内核，迎合其 mapping 机制&lt;/li>
&lt;/ul>
&lt;h3 id="配置示例">配置示例
&lt;/h3>&lt;p>👍 再次提醒，文章开始处的固件，所有配置已内置哦！&lt;/p>
&lt;h4 id="dnsmasq">dnsmasq
&lt;/h4>&lt;p>&lt;img src="https://alecthw.github.io/p/fuck-gfw/dnsmasq.png"
width="1453"
height="84"
srcset="https://alecthw.github.io/p/fuck-gfw/dnsmasq_hu_55e25a4cd64de615.png 480w, https://alecthw.github.io/p/fuck-gfw/dnsmasq_hu_10009cc241eca1f6.png 1024w"
loading="lazy"
alt="dnsmasq"
class="gallery-image"
data-flex-grow="1729"
data-flex-basis="4151px"
>&lt;/p>
&lt;h4 id="adguardhome">AdGuardHome
&lt;/h4>&lt;p>&lt;img src="https://alecthw.github.io/p/fuck-gfw/adguardhome_1.png"
width="1424"
height="197"
srcset="https://alecthw.github.io/p/fuck-gfw/adguardhome_1_hu_2cf26687e88d5e37.png 480w, https://alecthw.github.io/p/fuck-gfw/adguardhome_1_hu_8397c7c813616ae1.png 1024w"
loading="lazy"
alt="adguardhome_1"
class="gallery-image"
data-flex-grow="722"
data-flex-basis="1734px"
>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/fuck-gfw/adguardhome_2.png"
width="1427"
height="440"
srcset="https://alecthw.github.io/p/fuck-gfw/adguardhome_2_hu_bd4ea69b47c86176.png 480w, https://alecthw.github.io/p/fuck-gfw/adguardhome_2_hu_55cebf092f58ccb2.png 1024w"
loading="lazy"
alt="adguardhome_2"
class="gallery-image"
data-flex-grow="324"
data-flex-basis="778px"
>&lt;/p>
&lt;h4 id="openclash">openclash
&lt;/h4>&lt;p>&lt;img src="https://alecthw.github.io/p/fuck-gfw/openclash_1.png"
width="1731"
height="246"
srcset="https://alecthw.github.io/p/fuck-gfw/openclash_1_hu_4f39d226cd74ea6d.png 480w, https://alecthw.github.io/p/fuck-gfw/openclash_1_hu_94961e8467752b8b.png 1024w"
loading="lazy"
alt="openclash_1"
class="gallery-image"
data-flex-grow="703"
data-flex-basis="1688px"
>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/fuck-gfw/openclash_2.png"
width="1745"
height="293"
srcset="https://alecthw.github.io/p/fuck-gfw/openclash_2_hu_8457efb58deb5623.png 480w, https://alecthw.github.io/p/fuck-gfw/openclash_2_hu_6889f5779b2dcd9a.png 1024w"
loading="lazy"
alt="openclash_2"
class="gallery-image"
data-flex-grow="595"
data-flex-basis="1429px"
>&lt;/p>
&lt;p>注意删除默认的DNS配置，仅保留这一个即可。&lt;/p>
&lt;h4 id="mosdns">mosdns
&lt;/h4>&lt;p>使用自定义配置，由于使用了 mmdb geoip 匹配，mosdns 必须使用 &lt;a class="link" href="https://github.com/alecthw/mosdns" target="_blank" rel="noopener"
>alecthw 修改版&lt;/a>。&lt;/p>
&lt;p>PS: 以下配置中的 &lt;a class="link" href="https://github.com/alecthw/chnlist/blob/release/mosdns/whitelist.list" target="_blank" rel="noopener"
>cn-white.txt&lt;/a>，来自项目 &lt;a class="link" href="https://github.com/alecthw/chnlist" target="_blank" rel="noopener"
>chnlist&lt;/a>，我编译的固件已内置并设置自动更新，其他固件需要手动下载。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># 白名单模式&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># 白名单 或 境外查询IP是geoip:CN，走国内&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">log&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">level&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">info&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/tmp/mosdns.log&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">plugins&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># mmdb&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">country&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mmdb&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/etc/mosdns/rule/Country.mmdb&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># cn ip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">whitelist&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">domain_set&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;/etc/mosdns/rule/cn-white.txt&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 广告域名列表 geosite:category-ads-all&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">geosite_ads&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">domain_set&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;/etc/mosdns/rule/reject-list.txt&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">entries&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;localhost 127.0.0.1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 缓存&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">size&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">20480&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">lazy_cache_ttl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">86400&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dump_file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/etc/mosdns/cache.dump&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dump_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1800&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 查询境外DNS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">forward_global&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">forward&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">concurrent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">upstreams&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Google_dot&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;tls://8.8.4.4&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Quad9_dot&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;tls://9.9.9.9&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cloudflare_dot&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;tls://1.0.0.1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">OpenDNS_dot&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;tls://208.67.222.222&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 查询国内DNS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">forward_china&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">forward&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">concurrent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">upstreams&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Ali_dot&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;tls://223.5.5.5&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">DNSPod_dot&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;tls://120.53.53.53&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 境外解析，优先IPV4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">global_sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">qname $whitelist&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">return&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">prefer_ipv4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$forward_global&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">resp_ip_mmdb $country CN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">drop_resp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 国内解析，不设置过滤，作为fallback&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">china_sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$forward_china&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 屏蔽解析&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">reject_sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">qname $geosite_ads&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">reject 3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">qtype 12&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">reject 3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - matches: qtype 65&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># exec: reject 3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 如果 primary 抛出错误，或返回但没有应答，或在 threshold 毫秒内无响应，则执行 secondary。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 所以在 primary 中不能用 rejcet，reject 也是应答&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Fallback&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fallback&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fallback&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">primary&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">global_sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secondary&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">china_sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">threshold&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">150&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">always_standby&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main_sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$reject_sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">has_resp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">accept&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">has_resp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">accept&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$fallback&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">has_resp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ttl 10-600&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">udp_server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">udp_server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">entry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main_sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">5335&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="防火墙劫持-53-端口可选">防火墙，劫持 53 端口（可选）
&lt;/h4>&lt;p>防止客户端自定义 DNS 服务器，从而绕过管控，可以在防火墙自定义规则配置劫持 53 端口 UDP 和 UDP。&lt;/p>
&lt;p>但是，如果客户端配置加密 DNS 就没法劫持。如果要限制，对于 DoT 和 DoQ 可以屏蔽 853 端口禁用，但是 DoH 就完全没办法。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 同时支持 iptables 和 ip6tables&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dns_redirect&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">cmd&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;-t nat -A PREROUTING -p &lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2"> --dport 53 -j REDIRECT --to-ports 53&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">chk&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$cmd&lt;/span> &lt;span class="p">|&lt;/span> sed -e &lt;span class="s1">&amp;#39;s/-A/-C/g&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$cmd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$chk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$2&lt;/span> &lt;span class="nv">$chk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">ret&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$ret&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> -ne &lt;span class="m">0&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$2&lt;/span> &lt;span class="nv">$cmd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dns_redirect udp iptables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dns_redirect tcp iptables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> -n &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">command&lt;/span> -v ip6tables&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> dns_redirect udp ip6tables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> -n &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">command&lt;/span> -v ip6tables&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> dns_redirect tcp ip6tables
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="作为主路由时使用的特别说明">作为主路由时使用的特别说明
&lt;/h2>&lt;h3 id="主路由-dhcp-服务器">主路由 DHCP 服务器
&lt;/h3>&lt;p>DHCP 服务器设置中的 DNS 服务器，务必设置成旁路由，不要设置公共 DNS。&lt;/p>
&lt;h3 id="主路由-ipv6">主路由 IPv6
&lt;/h3>&lt;ol>
&lt;li>不通告 IPv6 DNS 服务器，DNS 解析全部走 IPv4。&lt;/li>
&lt;li>通告 DNS 服务器为路由器自己，即路由器的链路本地地址。&lt;/li>
&lt;/ol>
&lt;h2 id="作为旁路由时使用的特别说明">作为旁路由时使用的特别说明
&lt;/h2>&lt;h3 id="旁路由-dhcp-服务器">旁路由 DHCP 服务器
&lt;/h3>&lt;p>一般情况下建议禁用旁路由 DHCP 服务器，在主路由配置 DHCP 服务器，把网关设置成旁路由，或者通过静态分配指定不同客户端指向不同网关。&lt;/p>
&lt;p>DHCP 服务器设置中的 DNS 服务器，务必设置成旁路由，不要设置公共 DNS。&lt;/p>
&lt;h3 id="旁路由-ipv6">旁路由 IPv6
&lt;/h3>&lt;p>主路由上请勿通告 IPv6 DNS 服务器（这里指 IPv6 地址的 DNS 服务器，如 2400:3200::1）。通过 IPv4 地址的 DNS 服务器解析域名，一样可以拿到 AAAA 记录，所以没必要开启 IPv6 地址的 DNS 服务器，开启反而会增加配置难度，影响 DNS 分流，并可能造成 DNS 泄露。&lt;/p>
&lt;p>如下查询示例，可以看到，通过 IPv4 DNS 服务器可以获得 IPv6 地址。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ nslookup www.iqiyi.com 223.5.5.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Server: 223.5.5.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Address: 223.5.5.5#53
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Non-authoritative answer:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">www.iqiyi.com canonical &lt;span class="nv">name&lt;/span> &lt;span class="o">=&lt;/span> ipv6-static.dns.iqiyi.com.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: ipv6-static.dns.iqiyi.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Address: 101.227.12.45
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: ipv6-static.dns.iqiyi.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Address: 101.227.12.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: ipv6-static.dns.iqiyi.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Address: 240e:e1:a400:1c::22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: ipv6-static.dns.iqiyi.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Address: 240e:e1:a400:1c::21
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Openwrt、iKuai、RouterOS 都是支持不通告 IPv6 DNS 的。如果你的主路由不支持，IPv6 DNS 可以填个无效地址，如 &lt;code>::1&lt;/code>。&lt;/p></description></item><item><title>Windows 11 LSTC 安装和使用问题</title><link>https://alecthw.github.io/p/win11-lstc-faq/</link><pubDate>Mon, 11 Nov 2024 10:11:11 +0800</pubDate><guid>https://alecthw.github.io/p/win11-lstc-faq/</guid><description>&lt;img src="https://alecthw.github.io/p/win11-lstc-faq/cover.jpg" alt="Featured image of post Windows 11 LSTC 安装和使用问题" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;p>Windows 11 LSTC 问题总结，持续更新。&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;h3 id="下载">下载
&lt;/h3>&lt;p>只推荐从 &lt;a class="link" href="https://next.itellyou.cn/" target="_blank" rel="noopener"
>MSDN, i tell you&lt;/a> 下载。需要使用 BT 工具，如 Aria2、迅雷等。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/win11-lstc-faq/win11-next-itellyou.png"
width="1823"
height="545"
srcset="https://alecthw.github.io/p/win11-lstc-faq/win11-next-itellyou_hu_20f0a68e16ac461d.png 480w, https://alecthw.github.io/p/win11-lstc-faq/win11-next-itellyou_hu_942224a991cf89aa.png 1024w"
loading="lazy"
alt="win11-next-itellyou"
class="gallery-image"
data-flex-grow="334"
data-flex-basis="802px"
>&lt;/p>
&lt;h3 id="制作启动盘">制作启动盘
&lt;/h3>&lt;p>使用 &lt;a class="link" href="https://rufus.ie/zh/" target="_blank" rel="noopener"
>Rufus&lt;/a> 制作启动 U盘。&lt;/p>
&lt;h3 id="微软账户登录">微软账户登录
&lt;/h3>&lt;p>LSTC 版本不强制使用微软账户登录，可以跳过。&lt;/p>
&lt;p>&lt;strong>TIPs&lt;/strong>：安装过程中，不推荐直接使用微软账户登录，应该先创建&lt;strong>纯英文数字&lt;/strong>的无密码用户，进入系统后再使用微软账户登录。&lt;/p>
&lt;h3 id="激活">激活
&lt;/h3>&lt;p>LSTC 本身属于企业版。&lt;/p>
&lt;h4 id="方式一kms-激活">方式一：KMS 激活
&lt;/h4>&lt;p>自建服务额：&lt;a class="link" href="https://github.com/Wind4/vlmcsd" target="_blank" rel="noopener"
>vlmcsd&lt;/a>。多数 OpenWRT 固件都集成了。&lt;/p>
&lt;p>公开的 KMS 服务器：&lt;a class="link" href="https://www.coolhub.top/tech-articles/kms_list.html" target="_blank" rel="noopener"
>KMS 地址列表&lt;/a>&lt;/p>
&lt;p>以管理员身份运行&lt;code>命令提示符&lt;/code>，执行如下命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">slmgr&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">skms&lt;/span> &lt;span class="n">kms&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">03k&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">org&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">slmgr&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">ato&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="方式二mas">方式二：MAS
&lt;/h4>&lt;p>参考官方：&lt;a class="link" href="https://massgrave.dev/" target="_blank" rel="noopener"
>MAS&lt;/a>&lt;/p>
&lt;h2 id="使用">使用
&lt;/h2>&lt;h3 id="恢复传统右键菜单">恢复传统右键菜单
&lt;/h3>&lt;p>以管理员身份运行&lt;code>命令提示符&lt;/code>，执行如下命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">reg&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="s2">&amp;#34;HKCU\Software\Classes\CLSID\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\InprocServer32&amp;#34;&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">ve&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">taskkill&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">im&lt;/span> &lt;span class="n">explorer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">exe&lt;/span> &lt;span class="p">&amp;amp;&lt;/span> &lt;span class="nb">start &lt;/span>&lt;span class="n">explorer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">exe&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>还原：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">reg&lt;/span> &lt;span class="n">delete&lt;/span> &lt;span class="s2">&amp;#34;HKCU\Software\Classes\CLSID\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}&amp;#34;&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">f&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">taskkill&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">im&lt;/span> &lt;span class="n">explorer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">exe&lt;/span> &lt;span class="p">&amp;amp;&lt;/span> &lt;span class="nb">start &lt;/span>&lt;span class="n">explorer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">exe&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="应用商店-microsoft-store">应用商店 Microsoft Store
&lt;/h3>&lt;p>以管理员身份运行&lt;code>命令提示符&lt;/code>，执行如下命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">wsreset&lt;/span> &lt;span class="n">-i&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>该命令执行完没有回显，请耐心等待，直到开始里出现 Microsoft Store 应用。&lt;/p>
&lt;h3 id="访问共享文件报错-0x80004005-0x80070035">访问共享文件报错 0X80004005 0x80070035
&lt;/h3>&lt;p>以管理员身份运行&lt;code>命令提示符&lt;/code>，执行如下命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">reg&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="s2">&amp;#34;HKLM\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters&amp;#34;&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="n">AllowInsecureGuestAuth&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">t&lt;/span> &lt;span class="n">reg_dword&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="mf">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">reg&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="s2">&amp;#34;HKLM\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters&amp;#34;&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="n">RequireSecuritySignature&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">t&lt;/span> &lt;span class="n">reg_dword&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="mf">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="运行游戏一直弹窗-msgamingoverlay">运行游戏一直弹窗 msgamingoverlay
&lt;/h3>&lt;p>以管理员身份运行&lt;code>命令提示符&lt;/code>，执行如下命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">reg&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="s2">&amp;#34;HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\GameDVR&amp;#34;&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="n">AppCaptureEnabled&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">t&lt;/span> &lt;span class="n">reg_dword&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="mf">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">reg&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="s2">&amp;#34;HKCU\System\GameConfigStore&amp;#34;&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="n">GameDVR_Enabled&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">t&lt;/span> &lt;span class="n">reg_dword&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="mf">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="office-安装">Office 安装
&lt;/h3>&lt;p>推荐使用 &lt;a class="link" href="https://otp.landian.vip/zh-cn/#" target="_blank" rel="noopener"
>Office Tool Plus&lt;/a> 安装。&lt;/p>
&lt;p>安装选项：&lt;/p>
&lt;ul>
&lt;li>体系结构：64位&lt;/li>
&lt;li>产品：Office Mondo 2016 - MondoRetail。&lt;strong>注意：无论是否需要使用 OneDrive，此处都不选择。&lt;/strong>&lt;/li>
&lt;li>语言：简体中文（中国） - zh-cn&lt;/li>
&lt;/ul>
&lt;p>安装后激活：&lt;/p>
&lt;ol>
&lt;li>许可证管理 -&amp;gt; 卸载所有许可证&lt;/li>
&lt;li>许可证管理 -&amp;gt; 安装许可证：Office Mondo 2016 - 批量许可证&lt;/li>
&lt;li>KMS 管理 -&amp;gt; KMS 主机：使用 &lt;a class="link" href="https://github.com/Wind4/vlmcsd" target="_blank" rel="noopener"
>vlmcsd&lt;/a> 自建或者 &lt;a class="link" href="https://www.coolhub.top/tech-articles/kms_list.html" target="_blank" rel="noopener"
>KMS 地址列表&lt;/a>选一个&lt;/li>
&lt;li>许可证管理 -&amp;gt; 激活&lt;/li>
&lt;/ol>
&lt;h3 id="onedrive">OneDrive
&lt;/h3>&lt;h4 id="下载安装">下载安装
&lt;/h4>&lt;p>&lt;a class="link" href="https://www.microsoft.com/en-us/microsoft-365/onedrive/download?ocid=ORSEARCH_Bing" target="_blank" rel="noopener"
>下载 OneDrive&lt;/a>&lt;/p>
&lt;h4 id="修复资源管理器中-onedrive---personal-失效问题">修复资源管理器中 &lt;code>OneDrive - Personal&lt;/code> 失效问题
&lt;/h4>&lt;p>该问题是由于 LTSC 注册表无 OneDrive 的 ID {A52BBA46-E9E1-435f-B3D9-28DAA648C0F6} 定义导致。&lt;/p>
&lt;p>解决方案是新建一个 &lt;code>onedrive.reg&lt;/code> 文件，输入如下内容，然后右键 &lt;code>onedrive.reg&lt;/code> 以管理员身份运行导入注册表。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-reg" data-lang="reg">&lt;span class="line">&lt;span class="cl">Windows Registry Editor Version 5.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_LOCAL_MACHINE&lt;/span>&lt;span class="k">\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{A52BBA46-E9E1-435f-B3D9-28DAA648C0F6}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;Attributes&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;Category&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000004&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;DefinitionFlags&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000040&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;Icon&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">hex(2)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,&lt;/span>&lt;span class="err">\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">00,25,00,5c,00,73,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,69,00,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">6d,00,61,00,67,00,65,00,72,00,65,00,73,00,2e,00,64,00,6c,00,6c,00,2c,00,2d,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">00,31,00,30,00,34,00,30,00,00,00&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;LocalizedName&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">hex(2)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">40,00,25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,&lt;/span>&lt;span class="err">\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">6f,00,6f,00,74,00,25,00,5c,00,53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">00,5c,00,53,00,65,00,74,00,74,00,69,00,6e,00,67,00,53,00,79,00,6e,00,63,00,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">43,00,6f,00,72,00,65,00,2e,00,64,00,6c,00,6c,00,2c,00,2d,00,31,00,30,00,32,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">00,34,00,00,00&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;LocalRedirectOnly&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;Name&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;OneDrive&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;ParentFolder&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;{5E6C858F-0E22-4760-9AFE-EA3317B67173}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;ParsingName&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;shell:::{018D5C66-4533-4307-9B53-224DE2ED1FE6}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;RelativePath&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;OneDrive&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_LOCAL_MACHINE&lt;/span>&lt;span class="k">\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{A52BBA46-E9E1-435f-B3D9-28DAA648C0F6}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;Attributes&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;Category&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000004&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;DefinitionFlags&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000040&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;Icon&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">hex(2)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,&lt;/span>&lt;span class="err">\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">00,25,00,5c,00,73,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,69,00,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">6d,00,61,00,67,00,65,00,72,00,65,00,73,00,2e,00,64,00,6c,00,6c,00,2c,00,2d,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">00,31,00,30,00,34,00,30,00,00,00&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;LocalizedName&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">hex(2)&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">40,00,25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,&lt;/span>&lt;span class="err">\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">6f,00,6f,00,74,00,25,00,5c,00,53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">00,5c,00,53,00,65,00,74,00,74,00,69,00,6e,00,67,00,53,00,79,00,6e,00,63,00,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">43,00,6f,00,72,00,65,00,2e,00,64,00,6c,00,6c,00,2c,00,2d,00,31,00,30,00,32,\&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">00,34,00,00,00&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;LocalRedirectOnly&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;Name&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;OneDrive&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;ParentFolder&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;{5E6C858F-0E22-4760-9AFE-EA3317B67173}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;ParsingName&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;shell:::{018D5C66-4533-4307-9B53-224DE2ED1FE6}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;RelativePath&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;OneDrive&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除-网络1-网络2-网络3">删除 网络1 网络2 网络3……
&lt;/h3>&lt;p>删除以下两个注册表位置的所有子项，然后重启电脑即可&lt;/p>
&lt;ul>
&lt;li>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles&lt;/li>
&lt;li>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged&lt;/li>
&lt;/ul>
&lt;h2 id="应用兼容问题">应用兼容问题
&lt;/h2>&lt;h3 id="jetbrains-系列-shift--f6-失效">JetBrains 系列 Shift + F6 失效
&lt;/h3>&lt;p>JetBrains 插件商店搜索 &lt;code>Imefix&lt;/code> 插件，安装即可解决。&lt;/p></description></item><item><title>手把手教你科学上网 —— 手机篇（sing-box）</title><link>https://alecthw.github.io/p/singbox-help-mobile/</link><pubDate>Fri, 18 Oct 2024 10:16:19 +0800</pubDate><guid>https://alecthw.github.io/p/singbox-help-mobile/</guid><description>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/cover.png" alt="Featured image of post 手把手教你科学上网 —— 手机篇（sing-box）" />&lt;h2 id="手机科学上网需要些什么">手机科学上网需要些什么
&lt;/h2>&lt;ul>
&lt;li>一部手机（废话）&lt;/li>
&lt;li>机场/梯子，术语叫代理、VPN，推荐购买 &lt;a class="link" href="https://xminb.xiaomiaff.cc/register.html?invitecode=DBQFuexi" target="_blank" rel="noopener"
>五树云机场（原小米梯子）&lt;/a> 或 &lt;a class="link" href="https://ccv2.xiaojikp.pro/#/register?code=tqB3FCup" target="_blank" rel="noopener"
>小鸡快跑&lt;/a>&lt;/li>
&lt;li>客户端软件，文中使用 &lt;a class="link" href="https://github.com/SagerNet/sing-box" target="_blank" rel="noopener"
>sing-box&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>打个比喻，客户端软件是车，机场/梯子是路，两个都有了才能跑。&lt;/p>
&lt;h2 id="说在前面">说在前面
&lt;/h2>&lt;ol>
&lt;li>机场/梯子肯定是要花钱买的！这里给你推荐，但不售卖。&lt;/li>
&lt;li>Apple iOS 端安装需要外区账号，如果你没本事注册，就花几块钱买，后面会推荐购买平台。&lt;/li>
&lt;/ol>
&lt;h2 id="具体步骤">具体步骤
&lt;/h2>&lt;p>不讲原理，只说怎么用。原理可以去参考本博客其他文章。&lt;/p>
&lt;h3 id="1-购买机场梯子">1. 购买机场/梯子
&lt;/h3>&lt;ul>
&lt;li>推荐购买：&lt;a class="link" href="https://xminb.xiaomiaff.cc/register.html?invitecode=DBQFuexi" target="_blank" rel="noopener"
>五树云机场（原小米梯子）&lt;/a> 或 &lt;a class="link" href="https://ccv2.xiaojikp.pro/#/register?code=tqB3FCup" target="_blank" rel="noopener"
>小鸡快跑&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>其他机场可能需要&lt;strong>订阅转换&lt;/strong>才能在 &lt;a class="link" href="https://github.com/SagerNet/sing-box" target="_blank" rel="noopener"
>sing-box&lt;/a> 上使用。&lt;/p>
&lt;p>以下内容以 &lt;a class="link" href="https://ccv2.xiaojikp.pro/#/register?code=tqB3FCup" target="_blank" rel="noopener"
>小鸡快跑&lt;/a> 为例。&lt;/p>
&lt;p>注册后，选择&lt;code>购买订阅&lt;/code>购买，不同套餐一般都是流量不一样，按需购买。购买时间越长一般优惠越大，切合自己需求和经济能力购买。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/chickenrun-1.jpg"
width="2267"
height="1231"
srcset="https://alecthw.github.io/p/singbox-help-mobile/chickenrun-1_hu_f66645842ac2276.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/chickenrun-1_hu_e1f6c3cafadaa1a2.jpg 1024w"
loading="lazy"
alt="小鸡快跑购买订阅"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;p>购买完成后，回到&lt;code>仪表盘&lt;/code>，点击&lt;code>一键订阅&lt;/code>，再点击&lt;code>复制订阅地址&lt;/code>，保留好这个地址备用，一会儿再回来复制也行。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/chickenrun-2.jpg"
width="2267"
height="1238"
srcset="https://alecthw.github.io/p/singbox-help-mobile/chickenrun-2_hu_5aa24a934467036b.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/chickenrun-2_hu_1f6ad9442cd3af09.jpg 1024w"
loading="lazy"
alt="小鸡快跑订阅地址"
class="gallery-image"
data-flex-grow="183"
data-flex-basis="439px"
>&lt;/p>
&lt;h3 id="2-安装客户端软件">2. 安装客户端软件
&lt;/h3>&lt;p>本文推荐使用的是 &lt;a class="link" href="https://github.com/SagerNet/sing-box" target="_blank" rel="noopener"
>sing-box&lt;/a>，简单好用。&lt;/p>
&lt;p>安卓可以直接下载安装，iOS 需要&lt;strong>外区账号&lt;/strong>。&lt;/p>
&lt;h4 id="android-安装">Android 安装
&lt;/h4>&lt;p>Github 官方下载地址：&lt;a class="link" href="https://github.com/SagerNet/sing-box/releases" target="_blank" rel="noopener"
>https://github.com/SagerNet/sing-box/releases&lt;/a>&lt;/p>
&lt;p>请选择 &lt;code>SFA-{版本号}-universal.apk&lt;/code> 下载，因为不是从商店安装的，手机可能会提示风险，一直允许就行。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/singbox-dl.jpg"
width="1514"
height="559"
srcset="https://alecthw.github.io/p/singbox-help-mobile/singbox-dl_hu_e63440f63b9e91f2.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/singbox-dl_hu_9e70de680a6ac922.jpg 1024w"
loading="lazy"
alt="sing-box 下载"
class="gallery-image"
data-flex-grow="270"
data-flex-basis="650px"
>&lt;/p>
&lt;p>如果下载太慢，可以使用如下下载加速网站，右键复制链接后，贴到输入框里点击下载。&lt;/p>
&lt;p>Github 下载加速：&lt;a class="link" href="https://mirror.ghproxy.com/" target="_blank" rel="noopener"
>https://mirror.ghproxy.com/&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/ghproxy.jpg"
width="2238"
height="911"
srcset="https://alecthw.github.io/p/singbox-help-mobile/ghproxy_hu_86cb6581f9d81b6.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/ghproxy_hu_2f57241e37fe3372.jpg 1024w"
loading="lazy"
alt="Github 下载加速"
class="gallery-image"
data-flex-grow="245"
data-flex-basis="589px"
>&lt;/p>
&lt;h4 id="ios-安装">iOS 安装
&lt;/h4>&lt;p>由于 iOS 的封闭性，软件只能从 APP Store 安装，然而由于某些不可说的原因，国区商店是没有的，所以只能换&lt;strong>非国区&lt;/strong>下载。&lt;/p>
&lt;h5 id="准备苹果外区账号">准备苹果外区账号
&lt;/h5>&lt;p>如果你有外区账号，可以跳过本节。&lt;/p>
&lt;p>如果你没有外区账号，自行注册外区账号比较复杂，推荐花 ￥6.6 直接购买一个，地区推荐选择美国。&lt;/p>
&lt;p>苹果外区账号购买：&lt;a class="link" href="https://www.bigplayers.com/shop/detail?id=77&amp;amp;inviteCode=A9245220" target="_blank" rel="noopener"
>https://www.bigplayers.com/shop/detail?id=77&amp;inviteCode=A9245220&lt;/a>&lt;/p>
&lt;p>用外区账号登录 APP Store，务必按下图操作，否则有导致手机被锁的风险：&lt;/p>
&lt;p>&lt;strong>一定不要使用购买的账号登录 iCloud ！！！&lt;/strong>
&lt;strong>一定不要使用购买的账号登录 iCloud ！！！&lt;/strong>
&lt;strong>一定不要使用购买的账号登录 iCloud ！！！&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>设置--&amp;gt;头像--&amp;gt;媒体购买与订阅&lt;/code>&lt;/li>
&lt;li>点击&lt;code>媒体购买与订阅&lt;/code>选择&lt;code>退出登录&lt;/code>&lt;/li>
&lt;li>再点击一次击&lt;code>媒体购买与订阅&lt;/code>选择&lt;code>不是xxx&lt;/code>，输入账号登录&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/apple.jpg"
width="591"
height="1280"
srcset="https://alecthw.github.io/p/singbox-help-mobile/apple_hu_bf5b590ca31b09ad.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/apple_hu_fc8ed686bd50a262.jpg 1024w"
loading="lazy"
alt="苹果切换账号"
class="gallery-image"
data-flex-grow="46"
data-flex-basis="110px"
>&lt;/p>
&lt;h5 id="安装-sing-box">安装 sing-box
&lt;/h5>&lt;p>回到 APP Store，直接搜索 &lt;a class="link" href="https://apps.apple.com/us/app/sing-box/id6451272673" target="_blank" rel="noopener"
>sing-box&lt;/a> 安装即可。&lt;/p>
&lt;p>注意看下 Logo 和开发商，别下错了。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/singbox-app-store.jpg"
width="997"
height="390"
srcset="https://alecthw.github.io/p/singbox-help-mobile/singbox-app-store_hu_d21a6df7de51d21.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/singbox-app-store_hu_fa50d0842e17a3fb.jpg 1024w"
loading="lazy"
alt="苹果商店里的sing-box"
class="gallery-image"
data-flex-grow="255"
data-flex-basis="613px"
>&lt;/p>
&lt;h3 id="3-使用-sing-box">3. 使用 sing-box
&lt;/h3>&lt;p>iOS 和 Android 的界面有稍许差别。&lt;/p>
&lt;h4 id="android">Android
&lt;/h4>&lt;p>最下面选择 &lt;code>Profiles&lt;/code>，点击右下角添加图标，选择 &lt;code>Create Manually&lt;/code>。然后 Type 选择 &lt;code>Remote&lt;/code>，Name 可以任意填，URL 填入前面购买获取的订阅地址，最后点击 &lt;code>Create&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/singbox-android-2.jpg"
width="1280"
height="900"
srcset="https://alecthw.github.io/p/singbox-help-mobile/singbox-android-2_hu_52d3774ea10895b8.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/singbox-android-2_hu_fd146dfd0c8a44aa.jpg 1024w"
loading="lazy"
alt="安卓添加订阅"
class="gallery-image"
data-flex-grow="142"
data-flex-basis="341px"
>&lt;/p>
&lt;p>回到 &lt;code>Dashboard&lt;/code>，选择刚刚创建的 Profile，点击右下角的三角启动。&lt;/p>
&lt;p>首次启动会提示添加 VPN，按提示允许即可。第一次启动时间较长，耐心等待一会儿，直到出现下面第二张图的界面即可使用了。&lt;/p>
&lt;p>启动后默认是&lt;strong>规则模式&lt;/strong>（Rule，国内外自动分流，可以一直开着不关闭）。节点是&lt;strong>自动选择&lt;/strong>，也可按需手动选择。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/singbox-android-3.jpg"
width="1280"
height="675"
srcset="https://alecthw.github.io/p/singbox-help-mobile/singbox-android-3_hu_ee66df7298d0ba8.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/singbox-android-3_hu_199ad6f3b5196ca2.jpg 1024w"
loading="lazy"
alt="安卓启动"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="455px"
>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/singbox-android-1.jpg"
width="606"
height="1280"
srcset="https://alecthw.github.io/p/singbox-help-mobile/singbox-android-1_hu_4daa79561bebefe6.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/singbox-android-1_hu_2511809323b5f655.jpg 1024w"
loading="lazy"
alt="安卓添加 VPN"
class="gallery-image"
data-flex-grow="47"
data-flex-basis="113px"
>&lt;/p>
&lt;h4 id="ios">iOS
&lt;/h4>&lt;p>iOS 需要先点击 &lt;code>Install Network Extension&lt;/code> 添加 VPN 到系统，如下图。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-1.jpg"
width="591"
height="1280"
srcset="https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-1_hu_88df9a8b18c1af6a.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-1_hu_3a61c76bc26f044d.jpg 1024w"
loading="lazy"
alt="iOS 添加 VPN"
class="gallery-image"
data-flex-grow="46"
data-flex-basis="110px"
>&lt;/p>
&lt;p>最下面选择 &lt;code>Profiles&lt;/code>，点击 &lt;code>Create&lt;/code>。然后 Type 选择 &lt;code>Remote&lt;/code>，Name 可以任意填，URL 填入前面购买获取的订阅地址，最后点击 &lt;code>Create&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-2.jpg"
width="1280"
height="922"
srcset="https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-2_hu_ac4198c4befcd920.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-2_hu_61763c41167279ab.jpg 1024w"
loading="lazy"
alt="iOS 添加订阅"
class="gallery-image"
data-flex-grow="138"
data-flex-basis="333px"
>&lt;/p>
&lt;p>第一次启动时间较长，耐心等待一会儿，直到出现下面第二章图的界面即可使用了。&lt;/p>
&lt;p>启动后默认是&lt;strong>规则模式&lt;/strong>（Rule，国内外自动分流，可以一直开着不关闭）。节点是&lt;strong>自动选择&lt;/strong>，也可按需手动选择。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-3.jpg"
width="1280"
height="692"
srcset="https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-3_hu_ff7aa7ac6aac7f14.jpg 480w, https://alecthw.github.io/p/singbox-help-mobile/singbox-ios-3_hu_a559b6535f0009f8.jpg 1024w"
loading="lazy"
alt="iOS 启动"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="443px"
>&lt;/p>
&lt;h2 id="接下来可以干什么">接下来可以干什么
&lt;/h2>&lt;p>至此，Google、Youtube、Telegram 等等你都可以访问了，总之，自由了！&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;p>有时候因为特殊原因，机场会刷新订阅地址，如果发现无法使用或者更新不了订阅，请到机场仪表盘重新复制新地址。&lt;/p>
&lt;p>👉: &lt;a class="link" href="https://alecthw.github.io/p/netflix-help/" >看境外流媒体（Netflix、Disney+ 等）的详细教程&lt;/a>&lt;/p></description></item><item><title>境外流媒体观看简单指南</title><link>https://alecthw.github.io/p/netflix-help/</link><pubDate>Sun, 19 May 2024 11:21:12 +0800</pubDate><guid>https://alecthw.github.io/p/netflix-help/</guid><description>&lt;img src="https://alecthw.github.io/p/netflix-help/cover.jpg" alt="Featured image of post 境外流媒体观看简单指南" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;p>Nextflix, Disney+ 和 Prime Vedio 是有中文字幕的，推荐在新加坡区观看，账号本身不分区，科学上网节点选择新加坡即可。&lt;/p>
&lt;h2 id="网络环境">网络环境
&lt;/h2>&lt;p>国外的大部分流媒体厂商，基本都禁止了大陆 IP，并且会检测 VPN。所以，一个能解锁流媒体的 VPN 是必备条件。&lt;/p>
&lt;p>目前大部分机场，基本都解锁了 Nextflix，其他的流媒体不是都解锁，购买时请注意下说明。&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>。&lt;/p>
&lt;p>手机科学上网教程可以参考：&lt;a class="link" href="https://alecthw.github.io/p/singbox-help-mobile/" >手把手教你科学上网 —— 手机篇（sing-box）&lt;/a>&lt;/p>
&lt;p>路由器科学上网教程可以参考：&lt;a class="link" href="https://alecthw.github.io/p/fuck-gfw/" >AGuardHome + mosdns + openclash 打造自由的家庭/办公室网络&lt;/a>&lt;/p>
&lt;h2 id="账号">账号
&lt;/h2>&lt;p>Nextflix 已经清退了大部分低价区用户，包括土区也无法使用了，在高价区自己订阅不划算，建议直接购买合租账号。&lt;/p>
&lt;p>这里推荐一个本人使用快四年的一个合租平台：&lt;a class="link" href="https://ihezu.zone/Ks3NUR" target="_blank" rel="noopener"
>奈飞小铺&lt;/a>&lt;/p>
&lt;p>都是平台作为号主的自营车，稳定可靠，9 折优惠码: &lt;code>letsfuckgfw&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/netflix-help/ihezu.jpg"
width="2560"
height="1194"
srcset="https://alecthw.github.io/p/netflix-help/ihezu_hu_9036561c41246709.jpg 480w, https://alecthw.github.io/p/netflix-help/ihezu_hu_57b70615dc9a0e3f.jpg 1024w"
loading="lazy"
alt="奈飞小铺"
class="gallery-image"
data-flex-grow="214"
data-flex-basis="514px"
>&lt;/p>
&lt;h2 id="客户端">客户端
&lt;/h2>&lt;p>网页观看也是可以的，直截了当。&lt;/p>
&lt;h3 id="ios">iOS
&lt;/h3>&lt;p>iOS 是需要外区账号的，获取外区账号可以参考：&lt;a class="link" href="https://alecthw.github.io/p/singbox-help-mobile/#%e5%87%86%e5%a4%87%e8%8b%b9%e6%9e%9c%e5%a4%96%e5%8c%ba%e8%b4%a6%e5%8f%b7" >手把手教你科学上网/准备外区账号&lt;/a>。&lt;/p>
&lt;p>使用外区账号下载对应客户端，用购买的合租账号登录即可。&lt;/p>
&lt;p>&lt;strong>友情提醒，千万别用购买的账号登录 iCloud，否则有手机被锁的风险！&lt;/strong>&lt;/p>
&lt;h3 id="安卓">安卓
&lt;/h3>&lt;h4 id="1-google-play-商店安装">1. Google Play 商店安装
&lt;/h4>&lt;p>推荐方式，先安装 谷歌框架 和 Google Play，然后在 Play 商店中安装。&lt;/p>
&lt;p>各个品牌手机安装谷歌框架，在 B 站都有教程，自己去搜下。&lt;/p>
&lt;h4 id="2-apk-安装">2. APK 安装
&lt;/h4>&lt;p>YouTube 和 Nextflix APK 安装后打开软件，可能还会提示需要谷歌框架。&lt;/p>
&lt;p>下载 APK 可以使用 &lt;a class="link" href="https://apkpure.com/cn/" target="_blank" rel="noopener"
>APKPure&lt;/a>、&lt;a class="link" href="https://www.apkmirror.com/" target="_blank" rel="noopener"
>APKMirror&lt;/a> 等。&lt;/p>
&lt;h3 id="电视端">电视端
&lt;/h3>&lt;h4 id="apple-tv">Apple TV
&lt;/h4>&lt;p>同 iOS 手机端一样，需要外区账号，且激活设备时必须使用外区账号，否则没有 APP Store。因此，如果要使用 Apple TV，建议注册一个自己的外区账号。&lt;/p>
&lt;p>Apple TV 无法安装国内视频平台软件。&lt;/p>
&lt;p>当然，决定买 Apple TV 的时候，所有的问题应该都考虑到了。&lt;/p>
&lt;h4 id="安卓盒子">安卓盒子
&lt;/h4>&lt;p>国产盒子看 Youtube 可以安装 &lt;a class="link" href="https://smarttubeapp.github.io/" target="_blank" rel="noopener"
>SmartTube&lt;/a>。&lt;/p>
&lt;p>国产电视盒子由于没有 Netflix 认证，即使安装了也看不了高清。&lt;/p>
&lt;p>所以建议直接购买境外版的电视盒子，通过 APK 安装国内视频平台软件，可以用得比较舒适。&lt;/p>
&lt;p>盒子的选择上推荐：&lt;/p>
&lt;ul>
&lt;li>Nvidia Shield TV: 有点贵，但是国内使用体验很好，虽然好几年没有出新，但是性能仍然过剩&lt;/li>
&lt;li>Chromecast GoogleTV&lt;/li>
&lt;li>小米盒子国际版&lt;/li>
&lt;li>FireTV&lt;/li>
&lt;/ul>
&lt;p>这些开机需要通过&lt;strong>谷歌账号&lt;/strong>激活，注册谷歌账号还是很容易的，但是此时还没进入系统不能安装软件，需要路由器能够科学上网才能正常激活。实在搞不定，购买的时候可以让店家帮忙激活，到手换成自己账号即可。&lt;/p></description></item><item><title>RouterOS 给 UPNP 设置白名单，避免 APP 白嫖上行带宽</title><link>https://alecthw.github.io/p/routeros-upnp-blcok/</link><pubDate>Mon, 26 Feb 2024 20:11:45 +0800</pubDate><guid>https://alecthw.github.io/p/routeros-upnp-blcok/</guid><description>&lt;img src="https://alecthw.github.io/p/routeros-upnp-blcok/cover.jpg" alt="Featured image of post RouterOS 给 UPNP 设置白名单，避免 APP 白嫖上行带宽" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="ros-的-upnp">ROS 的 UPNP
&lt;/h2>&lt;p>由于 ROS 的 UPNP 功能没有自带类似黑白名单类似的功能，那只能从防火墙入手了。&lt;/p>
&lt;p>UPNP 服务端涉及两个端口，1900(UDP) 和 2828(TCP)。那么，目标就很明确了：&lt;/p>
&lt;ol>
&lt;li>建个白名单&lt;/li>
&lt;li>仅允许白名单内的 IP 访问这两个端口&lt;/li>
&lt;/ol>
&lt;h2 id="配置过程">配置过程
&lt;/h2>&lt;h3 id="创建一个名称为-allow_upnp-的地址列表作白名单">创建一个名称为 &lt;code>allow_upnp&lt;/code> 的地址列表作白名单
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/ip firewall address-list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>192.168.1.1 &lt;span class="nv">list&lt;/span>&lt;span class="o">=&lt;/span>allow_upnp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>192.168.1.2 &lt;span class="nv">list&lt;/span>&lt;span class="o">=&lt;/span>allow_upnp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="创建两条-filter-规则">创建两条 filter 规则
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/ip firewall filter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add &lt;span class="nv">action&lt;/span>&lt;span class="o">=&lt;/span>drop &lt;span class="nv">chain&lt;/span>&lt;span class="o">=&lt;/span>input dst-port&lt;span class="o">=&lt;/span>&lt;span class="m">1900&lt;/span> &lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>udp src-address-list&lt;span class="o">=&lt;/span>!allow_upnp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add &lt;span class="nv">action&lt;/span>&lt;span class="o">=&lt;/span>drop &lt;span class="nv">chain&lt;/span>&lt;span class="o">=&lt;/span>input dst-port&lt;span class="o">=&lt;/span>&lt;span class="m">2828&lt;/span> &lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>tcp src-address-list&lt;span class="o">=&lt;/span>!allow_upnp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果原来规则较多，注意下放的位置。&lt;/p>
&lt;h3 id="重启下-upnp-服务">重启下 UPNP 服务
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/ip upnp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> &lt;span class="nv">enabled&lt;/span>&lt;span class="o">=&lt;/span>no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> &lt;span class="nv">enabled&lt;/span>&lt;span class="o">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样就配置好了，等个几个小时看看，NAT 列表里，除了允许的几个 IP 有 UPNP，其他应该都没有。世界清净了。&lt;/p>
&lt;p>如果有问题，优先检查 filter 规则顺序。&lt;/p>
&lt;h2 id="附dhcp-静态自动添加到地址列表">附：DHCP 静态自动添加到地址列表
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/ip dhcp-server lease
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>192.168.1.x mac-address&lt;span class="o">=&lt;/span>xx:xx:xx:xx:xx:xx address-lists&lt;span class="o">=&lt;/span>allow_upnp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>ESXi 直通核显开启硬解，Emby 配合 CloudDrive2 挂载云盘打造家用的流媒体</title><link>https://alecthw.github.io/p/emby-clouddrive2/</link><pubDate>Tue, 23 Jan 2024 10:31:42 +0800</pubDate><guid>https://alecthw.github.io/p/emby-clouddrive2/</guid><description>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/cover.jpg" alt="Featured image of post ESXi 直通核显开启硬解，Emby 配合 CloudDrive2 挂载云盘打造家用的流媒体" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;p>👉 注册 CloudDrive2 的时候可以填上我的推荐码哦：&lt;code>cAR6b415&lt;/code>。&lt;/p>
&lt;p>核心点：&lt;/p>
&lt;ol>
&lt;li>使用 CloudDrive2 把云盘挂载到本地。&lt;/li>
&lt;li>新款 CPU 如果没有硬解选项，就安装 beta 版的 emby。&lt;/li>
&lt;/ol>
&lt;p>&lt;code>PS：以下使用的ESXi 8.0，基于 Ubuntu 22.04 LTS，在 root 用户下操作。需要有简单的 Linux 基础知识，例如了解 SSH、VIM 怎么使用。&lt;/code>&lt;/p>
&lt;p>&lt;code>PS：CloudDrive2 和 Emby 的都是从 Github 下载的，连不上 Github 自行科学上网。&lt;/code>&lt;/p>
&lt;h2 id="esxi-核显直通">ESXi 核显直通
&lt;/h2>&lt;p>务必先创建好虚拟机，并配置好静态 IP 地址和 SSH！！！&lt;/p>
&lt;p>直通并添加核显到虚拟机之后，ESXi网页中，虚拟机的控制台将什么也不显示了。如果没有配置 IP 和 SSH，只能要么把虚拟机核显删掉，要么机器直接连显示器。&lt;/p>
&lt;h3 id="1-打开-esxi-ssh">1. 打开 ESXi SSH
&lt;/h3>&lt;p>如图所示操作。开启完使用工具登录，例如 Putty、XShell 等。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/esxi-ssh.jpg"
width="1507"
height="791"
srcset="https://alecthw.github.io/p/emby-clouddrive2/esxi-ssh_hu_1f806776f4846d1f.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/esxi-ssh_hu_a749ee4c3ce80ddd.jpg 1024w"
loading="lazy"
alt="ESXi 开启 SSH"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;h3 id="2-禁用-esxi-显卡调用">2. 禁用 ESXi 显卡调用
&lt;/h3>&lt;p>禁用后，机器连接显示器将不显示黄黑色控制台。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 禁用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">esxcli system settings kernel &lt;span class="nb">set&lt;/span> -s vga -v FALSE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看配置结果&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">esxcli system settings kernel list -o &lt;span class="s2">&amp;#34;vga&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查出的结果如下，&lt;code>Configured&lt;/code> 显示 &lt;code>FALSE&lt;/code> 即成功，等一会儿重启后 &lt;code>Runtime&lt;/code> 会变成 &lt;code>FALSE&lt;/code>。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">Name Type Configured Runtime Default Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---- ---- ---------- ------- ------- -----------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vga Bool FALSE TRUE TRUE Enable/Disable VGA support.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-passthrumap-增加核显">3. passthru.map 增加核显
&lt;/h3>&lt;p>查看核显设备ID&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 禁用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lspci -v &lt;span class="p">|&lt;/span> grep -A &lt;span class="m">2&lt;/span> VGA
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>返回的信息如下，关注下第二行。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">0000:00:02.0 Display controller VGA compatible controller: Intel Corporation Alder Lake-S GT1 [UHD Graphics 770]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Class 0300: 8086:5916
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>8086&lt;/code> 是供应商 ID，这里就是 Intel，&lt;code>5916&lt;/code> 就是硬件 ID。记下这8个字符，这里不要照抄哦，要用你自己的。&lt;/p>
&lt;p>用 vi 修改 &lt;code>passthru.map&lt;/code>，在最后添加&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl"># Intel VGA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">8086 5916 d3d0 default
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>保存，重启ESXi主机。&lt;/p>
&lt;h3 id="4-切换显卡直通">4. 切换显卡直通
&lt;/h3>&lt;p>ESXi Web 控制台下&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/uhd-direct.jpg"
width="2417"
height="550"
srcset="https://alecthw.github.io/p/emby-clouddrive2/uhd-direct_hu_28a61b23edb0fef8.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/uhd-direct_hu_c8dd587a5cd58a70.jpg 1024w"
loading="lazy"
alt="切换显卡直通"
class="gallery-image"
data-flex-grow="439"
data-flex-basis="1054px"
>&lt;/p>
&lt;p>切换成功后，直通显示为&lt;code>活动&lt;/code>。ESXi 7.x 和 ESXi 8.x 是不需要重启主机的，ESXi 6.7 可能还需要重启一次。&lt;/p>
&lt;h3 id="5-虚拟机添加核显">5. 虚拟机添加核显
&lt;/h3>&lt;p>创建虚拟机的步骤不再赘述。&lt;/p>
&lt;p>编辑虚拟机&lt;/p>
&lt;p>禁用 CPU 下虚拟化相关的三个配置&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/disable-cpu-cfg.jpg"
width="1399"
height="878"
srcset="https://alecthw.github.io/p/emby-clouddrive2/disable-cpu-cfg_hu_df36151170856c6d.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/disable-cpu-cfg_hu_68178c892668c809.jpg 1024w"
loading="lazy"
alt="禁用 CPU 下虚拟化相关的三个配置"
class="gallery-image"
data-flex-grow="159"
data-flex-basis="382px"
>&lt;/p>
&lt;p>内存下，勾选&lt;code>预留所有客户机内存&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/keep-mem.jpg"
width="1399"
height="777"
srcset="https://alecthw.github.io/p/emby-clouddrive2/keep-mem_hu_31fe5442d3e83b13.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/keep-mem_hu_61e391a368d7c12a.jpg 1024w"
loading="lazy"
alt="禁用 CPU 下虚拟化相关的三个配置"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="432px"
>&lt;/p>
&lt;p>添加 PCI 设备&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/add-pci.jpg"
width="1399"
height="748"
srcset="https://alecthw.github.io/p/emby-clouddrive2/add-pci_hu_4796992fff25fd98.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/add-pci_hu_cddfea870d20e678.jpg 1024w"
loading="lazy"
alt="添加 PCI 设备"
class="gallery-image"
data-flex-grow="187"
data-flex-basis="448px"
>&lt;/p>
&lt;p>在&lt;code>PCI设备1&lt;/code>中，选择你的核显。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/select-uhd.jpg"
width="1399"
height="803"
srcset="https://alecthw.github.io/p/emby-clouddrive2/select-uhd_hu_390d2f6b877a99df.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/select-uhd_hu_375edad98c45acc5.jpg 1024w"
loading="lazy"
alt="PCI 选择核显"
class="gallery-image"
data-flex-grow="174"
data-flex-basis="418px"
>&lt;/p>
&lt;p>保存，启动虚拟机。这一次启动可能会比较慢，耐心等待，直到 SSH 可以连接上虚拟机。&lt;/p>
&lt;h2 id="安装配置-clouddrive2">安装配置 CloudDrive2
&lt;/h2>&lt;p>后续虚拟机上，都是在 &lt;code>root&lt;/code> 用户下操作的。&lt;/p>
&lt;h3 id="1-虚拟机前置配置">1. 虚拟机前置配置
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 切换到 root 用户&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo su
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装 vim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y vim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 禁用防火墙&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl stop ufw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl disable ufw
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-安装">2. 安装
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.clouddrive2.com/download.html" target="_blank" rel="noopener"
>CloudDrive2 官网&lt;/a>下载 Linux 版本，使用 SFTP 客户端，上传到虚拟机的 &lt;code>/opt&lt;/code> 目录下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 进入 /opt 目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /opt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建一个新目录，给后续挂载云盘用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir /opt/mnt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 解压&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xzf clouddrive-2-linux-x86_64-*.tgz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 更名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv clouddrive-2-linux-x86_64-* clouddrive2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-创建-systemd-service">3. 创建 systemd service
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vim /lib/systemd/system/clouddrive2.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>填入以下内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">[Unit]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Description=clouddrive2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ConditionFileIsExecutable=/opt/clouddrive2/clouddrive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">After=network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wants=network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Service]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type=simple
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PIDFile=/var/run/clouddrive2.pid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ExecStart=/opt/clouddrive2/clouddrive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WorkingDirectory=/opt/clouddrive2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Restart=on-failure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Install]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WantedBy=multi-user.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="4-启动-clouddrive2">4. 启动 CloudDrive2
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> clouddrive2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start clouddrive2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="5-网页登陆配置">5. 网页登陆配置
&lt;/h3>&lt;p>&lt;a class="link" href="http://ip:19798/" target="_blank" rel="noopener"
>http://ip:19798/&lt;/a>&lt;/p>
&lt;p>注册登录后界面如下&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/clouddrive2.jpg"
width="2324"
height="802"
srcset="https://alecthw.github.io/p/emby-clouddrive2/clouddrive2_hu_5c457b16a03fc115.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/clouddrive2_hu_7495717d49f0943.jpg 1024w"
loading="lazy"
alt="CloudDrive2 界面"
class="gallery-image"
data-flex-grow="289"
data-flex-basis="695px"
>&lt;/p>
&lt;p>点击云图标添加网盘，登录授权。&lt;/p>
&lt;p>CloudDrive2 免费版功能有限制，一般情况下个人用户足够使用。具体可参考下图：&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/clouddrive2-vip.jpg"
width="1665"
height="993"
srcset="https://alecthw.github.io/p/emby-clouddrive2/clouddrive2-vip_hu_7c7d8ae65eab8050.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/clouddrive2-vip_hu_ee8b3f29ece43f37.jpg 1024w"
loading="lazy"
alt="CloudDrive2 VIP 价格"
class="gallery-image"
data-flex-grow="167"
data-flex-basis="402px"
>&lt;/p>
&lt;h3 id="6-挂载网盘到本地">6. 挂载网盘到本地
&lt;/h3>&lt;p>左树选择一个网盘（也可以选择子目录），然后点击&lt;code>电脑&lt;/code>图标，开始挂载，界面如下&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/mount.jpg"
width="2324"
height="1437"
srcset="https://alecthw.github.io/p/emby-clouddrive2/mount_hu_e8aecf18b289c11f.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/mount_hu_28c53eab5f711252.jpg 1024w"
loading="lazy"
alt="CloudDrive2 挂载"
class="gallery-image"
data-flex-grow="161"
data-flex-basis="388px"
>&lt;/p>
&lt;p>如果默认的名称为中文，建议改成&lt;code>英文/数字&lt;/code>，这个名称就是挂载后，Linux 本地的文件夹名称。&lt;/p>
&lt;p>点击&lt;code>选择&lt;/code>，选择挂载点，这里选择之前创建的 &lt;code>/opt/mnt&lt;/code> 目录&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/mount-dir.jpg"
width="1996"
height="1161"
srcset="https://alecthw.github.io/p/emby-clouddrive2/mount-dir_hu_4d574671e40f8431.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/mount-dir_hu_6b6ff4d896068730.jpg 1024w"
loading="lazy"
alt="CloudDrive2 挂载目录选择"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="412px"
>&lt;/p>
&lt;p>挂载成功后，命令行看一下虚拟机的目录，这里我挂载了 aliyun 和 115。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@ubuntu-emby:~# ls /opt/mnt/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">115&lt;/span> aliyun
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装配置-emby-server">安装配置 Emby-Server
&lt;/h2>&lt;p>注意：较新的CPU，建议下载 Beta 版本，否则硬解无法选择 &lt;code>QuickSync&lt;/code>。或者先安装标准版，发现硬解无法选择 &lt;code>QuickSync&lt;/code>，再覆盖安装 Beta 版。&lt;/p>
&lt;h3 id="1-安装">1. 安装
&lt;/h3>&lt;p>&lt;a class="link" href="https://emby.media/linux-server.html" target="_blank" rel="noopener"
>Emby 官网下载&lt;/a> ubuntu 版本的 deb 包。&lt;/p>
&lt;p>安装&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dpkg -i emby-server-deb_*_amd64.deb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装后已经自动启用了，可以再执行一遍以下命令，防止开机自启没开启。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> emby-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看运行状态&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl status emby-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-启动顺序">2. 启动顺序
&lt;/h3>&lt;p>由于使用了 CloudDrive2 挂载云盘，期望的是 CloudDrive2 要在 Emby 之前启动，才能保证 Emby 正常读取到网盘内容，避免报错。&lt;/p>
&lt;p>编辑 emby 的 service 文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vim /lib/systemd/system/emby-server.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 &lt;code>After=network.target&lt;/code> 后面，均添加 &lt;code>clouddrive2.service&lt;/code>，然后再添加一行 &lt;code>Wants=network.target clouddrive2.service&lt;/code>，如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">[Unit]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Description=Emby Server is a personal media server with apps on just about every device
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">After=network.target clouddrive2.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wants=network.target clouddrive2.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">·····
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重载并重启&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl restart emby-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意，升级安装 emby 后，这个 service 会被覆盖成默认的，需要再次修改。&lt;/p>
&lt;h3 id="3-配置-emby">3. 配置 Emby
&lt;/h3>&lt;p>&lt;a class="link" href="http://ip:8096/" target="_blank" rel="noopener"
>http://ip:8096/&lt;/a>&lt;/p>
&lt;p>登录后按照指引配置就行了，这里网上教程很多，不赘述。&lt;/p>
&lt;p>创建媒体库的时候，文件夹选择通过 CloudDrive2 挂载到本地的文件夹即可。例如：&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/emby-dir.jpg"
width="1442"
height="689"
srcset="https://alecthw.github.io/p/emby-clouddrive2/emby-dir_hu_340e910443afb1e0.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/emby-dir_hu_bfcf2848c795522d.jpg 1024w"
loading="lazy"
alt="Emby 媒体库目录"
class="gallery-image"
data-flex-grow="209"
data-flex-basis="502px"
>&lt;/p>
&lt;h3 id="4-emby-硬解">4. Emby 硬解
&lt;/h3>&lt;p>如下图，勾选 &lt;code>QuickSync&lt;/code>，调整顺序即可。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/emby-clouddrive2/emby-hd.jpg"
width="2268"
height="1425"
srcset="https://alecthw.github.io/p/emby-clouddrive2/emby-hd_hu_372628bb1708a5d5.jpg 480w, https://alecthw.github.io/p/emby-clouddrive2/emby-hd_hu_e8fed5a663eea793.jpg 1024w"
loading="lazy"
alt="Emby 硬解"
class="gallery-image"
data-flex-grow="159"
data-flex-basis="381px"
>&lt;/p>
&lt;p>然后，随便找个视频测试下转码，调整码率，拖拉快进等。&lt;/p>
&lt;h3 id="5-电视直播-m3u">5. 电视直播 m3u
&lt;/h3>&lt;p>目前好用的直播源都是 ipv6 的，如果正确配置了 ipv6，可以添加如下直播源和指南数据库。&lt;/p>
&lt;ul>
&lt;li>直播源：&lt;a class="link" href="https://live.fanmingming.com/tv/m3u/ipv6.m3u" target="_blank" rel="noopener"
>https://live.fanmingming.com/tv/m3u/ipv6.m3u&lt;/a>&lt;/li>
&lt;li>XmlTV：&lt;a class="link" href="https://live.fanmingming.com/e.xml" target="_blank" rel="noopener"
>https://live.fanmingming.com/e.xml&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>在 Hyper-V 中体验 陆大大的云固件 &amp; 使用 WinNTSetup 制作 L0 镜像</title><link>https://alecthw.github.io/p/cloud-firmware-hyperv/</link><pubDate>Sun, 14 Jan 2024 17:57:22 +0800</pubDate><guid>https://alecthw.github.io/p/cloud-firmware-hyperv/</guid><description>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/cover.png" alt="Featured image of post 在 Hyper-V 中体验 陆大大的云固件 &amp; 使用 WinNTSetup 制作 L0 镜像" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;p>关于云固件相关的资料，请参考 &lt;a class="link" href="https://zhuanlan.zhihu.com/p/651550564" target="_blank" rel="noopener"
>陆伟峰​的知乎&lt;/a>，这里不再赘述。&lt;/p>
&lt;p>过程是其实和硬件硬盘是一样的，这里只不过是用同样的方式创建虚拟磁盘，然后在 Hyper-V 中启动。&lt;/p>
&lt;h2 id="云固件文件准备">云固件文件准备
&lt;/h2>&lt;ul>
&lt;li>云固件：&lt;a class="link" href="https://pan.baidu.com/share/init?surl=E3LKPlyAZCUX8PhIkIu98Q&amp;amp;pwd=7217" target="_blank" rel="noopener"
>r23942（v1.6.23942）&lt;/a>&lt;/li>
&lt;li>Win11 L1 镜像：&lt;a class="link" href="https://pan.baidu.com/s/1qpRqRhTlG5PTk0EfspJomw" target="_blank" rel="noopener"
>Windows 11 专业版 L1基本安装镜像&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="软件准备">软件准备
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://www.diskgenius.cn/" target="_blank" rel="noopener"
>DiskGenius&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="开始制作">开始制作
&lt;/h2>&lt;p>整体还是比较简单的，先创建 vdhx 虚拟磁盘，然后用 DiskGenius 分区，最后然后再把 Win11 L1 镜像拷贝到 创建的 vhdx 中，配置启动镜像即可。&lt;/p>
&lt;h3 id="创建-vdhx">创建 vdhx
&lt;/h3>&lt;p>为了简单，这里给出使用磁盘管理图形界面的创建步骤。&lt;/p>
&lt;p>首先打开&lt;code>计算机管理&lt;/code>，然后点击左边的&lt;code>磁盘管理&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/pc_mgr.jpg"
width="555"
height="440"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/pc_mgr_hu_8780d31c607443da.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/pc_mgr_hu_20b11113fec037a8.jpg 1024w"
loading="lazy"
alt="计算机管理"
class="gallery-image"
data-flex-grow="126"
data-flex-basis="302px"
>&lt;/p>
&lt;p>右键，点击&lt;code>创建VHD&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vhdx_1.jpg"
width="1232"
height="571"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vhdx_1_hu_7d2368e26f0250b.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/create_vhdx_1_hu_5d98d68832b67125.jpg 1024w"
loading="lazy"
alt="创建虚拟磁盘"
class="gallery-image"
data-flex-grow="215"
data-flex-basis="517px"
>&lt;/p>
&lt;p>按下图输入大写和选择，注意大小要大于 &lt;code>260G&lt;/code>，具体原因参考陆大的文章。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vhdx_2.jpg"
width="551"
height="672"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vhdx_2_hu_8dfd088807b51763.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/create_vhdx_2_hu_86e0f383dabf7491.jpg 1024w"
loading="lazy"
alt="创建虚拟磁盘2"
class="gallery-image"
data-flex-grow="81"
data-flex-basis="196px"
>&lt;/p>
&lt;p>创建之后会自动挂载。&lt;/p>
&lt;h3 id="分区">分区
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">注意：操作千万小心，不要错选磁盘，认证核对，避免数据丢失，数据无价！！！
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">注意：操作千万小心，不要错选磁盘，认证核对，避免数据丢失，数据无价！！！
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">注意：操作千万小心，不要错选磁盘，认证核对，避免数据丢失，数据无价！！！
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>打开 &lt;code>DiskGenius&lt;/code>，选中刚刚创建的虚拟磁盘，然后点击&lt;code>快速分区&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/partition.jpg"
width="1519"
height="519"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/partition_hu_64798e11d358ecbd.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/partition_hu_c8f0a27861e81f7.jpg 1024w"
loading="lazy"
alt="分区"
class="gallery-image"
data-flex-grow="292"
data-flex-basis="702px"
>&lt;/p>
&lt;p>按下图选择，卷标输入 &lt;code>VDs&lt;/code>，点击&lt;code>确定&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/partition2.jpg"
width="835"
height="647"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/partition2_hu_604d631bd987bfd1.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/partition2_hu_2449114059e8d765.jpg 1024w"
loading="lazy"
alt="分区2"
class="gallery-image"
data-flex-grow="129"
data-flex-basis="309px"
>&lt;/p>
&lt;p>执行成功和，&lt;code>VDs&lt;/code> 应该被自动分配盘符挂载到系统了。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/my_pc.jpg"
width="1047"
height="185"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/my_pc_hu_20bc5b54a11ec735.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/my_pc_hu_e56fecc043eb3861.jpg 1024w"
loading="lazy"
alt="资源管理器"
class="gallery-image"
data-flex-grow="565"
data-flex-basis="1358px"
>&lt;/p>
&lt;p>还需要把 &lt;code>ESP&lt;/code> 分区也挂载到系统，只能在 DiskGenius 中操作。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/esp.jpg"
width="417"
height="578"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/esp_hu_56448e99b6ad2f8a.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/esp_hu_86937b6790c456a2.jpg 1024w"
loading="lazy"
alt="挂载ESP分区"
class="gallery-image"
data-flex-grow="72"
data-flex-basis="173px"
>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/my_pc2.jpg"
width="992"
height="167"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/my_pc2_hu_c46370574c1d5e8c.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/my_pc2_hu_8ccfccaf90982227.jpg 1024w"
loading="lazy"
alt="资源管理器2"
class="gallery-image"
data-flex-grow="594"
data-flex-basis="1425px"
>&lt;/p>
&lt;h3 id="复制文件">复制文件
&lt;/h3>&lt;p>将云固件解压到 &lt;code>ESP&lt;/code> 分区，如下图：&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_cd.jpg"
width="835"
height="293"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_cd_hu_39af2879f9d7d4e4.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_cd_hu_8f4a915b9f5ddc0d.jpg 1024w"
loading="lazy"
alt="云固件解压"
class="gallery-image"
data-flex-grow="284"
data-flex-basis="683px"
>&lt;/p>
&lt;p>将云固件中的 &lt;code>vd.config&lt;/code> 拷贝到 &lt;code>VDs&lt;/code> 分区中。&lt;/p>
&lt;p>再将下载的 &lt;code>Windows 11 专业版 L1基本安装镜像&lt;/code>，目录 &lt;code>b1882792&lt;/code> 中的 &lt;code>Windows11-22H2-Pro-L1.7z&lt;/code> 文件解压，解压后删除原文件 &lt;code>Windows11-22H2-Pro-L1.7z&lt;/code>。&lt;/p>
&lt;p>然后将目录 &lt;code>b1882792&lt;/code> 拷贝到 &lt;code>VDs&lt;/code> 分区中。目录结构如下。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_vd.jpg"
width="796"
height="292"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_vd_hu_b843856146f76fb0.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_vd_hu_2085cefa43d82c49.jpg 1024w"
loading="lazy"
alt="镜像解压"
class="gallery-image"
data-flex-grow="272"
data-flex-basis="654px"
>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_vd_2.jpg"
width="844"
height="360"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_vd_2_hu_71c7e92ca25ee7c.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/unzip_vd_2_hu_ab0dea304bef570a.jpg 1024w"
loading="lazy"
alt="镜像解压2"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="562px"
>&lt;/p>
&lt;h3 id="分离vhd">分离VHD
&lt;/h3>&lt;p>（可选）在 &lt;code>DiskGenius&lt;/code> 中删除 &lt;code>ESP&lt;/code> 分区的盘符。&lt;/p>
&lt;p>在&lt;code>磁盘管理&lt;/code>中，右键虚拟磁盘，点击&lt;code>分离VHD&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/unmount_vhdx.jpg"
width="767"
height="235"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/unmount_vhdx_hu_c2089ec6efe0adc5.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/unmount_vhdx_hu_9e80853d8082c18e.jpg 1024w"
loading="lazy"
alt="分离VHD"
class="gallery-image"
data-flex-grow="326"
data-flex-basis="783px"
>&lt;/p>
&lt;p>至此，Hypver-V 上的云固件虚拟盘就做好了。&lt;/p>
&lt;h2 id="在-hyper-v-中创建虚拟机">在 Hyper-V 中创建虚拟机
&lt;/h2>&lt;p>按如下步骤创建，选择&lt;code>第二代&lt;/code>，虚拟磁盘选择&lt;code>使用现有&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_1.jpg"
width="980"
height="413"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_1_hu_6399208f3dc59d03.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_1_hu_2f04e525b49ed817.jpg 1024w"
loading="lazy"
alt="创建VM1"
class="gallery-image"
data-flex-grow="237"
data-flex-basis="569px"
>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_2.jpg"
width="980"
height="384"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_2_hu_f78575d1221817c6.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_2_hu_bc6f8f71e81fe196.jpg 1024w"
loading="lazy"
alt="创建VM2"
class="gallery-image"
data-flex-grow="255"
data-flex-basis="612px"
>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_3.jpg"
width="976"
height="377"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_3_hu_2db735f6d6124016.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_3_hu_6010c29f2abdc83a.jpg 1024w"
loading="lazy"
alt="创建VM3"
class="gallery-image"
data-flex-grow="258"
data-flex-basis="621px"
>&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_4.jpg"
width="968"
height="722"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_4_hu_51731e7f17019676.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_4_hu_1ff759161a248f30.jpg 1024w"
loading="lazy"
alt="创建VM4"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="321px"
>&lt;/p>
&lt;p>创建完成后，在虚拟机设置中，禁用安全启动。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_5.jpg"
width="1046"
height="437"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_5_hu_29f7006f045f55b1.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/create_vm_5_hu_968ce2b384b14173.jpg 1024w"
loading="lazy"
alt="创建VM5"
class="gallery-image"
data-flex-grow="239"
data-flex-basis="574px"
>&lt;/p>
&lt;h3 id="启动运行">启动运行
&lt;/h3>&lt;p>双击虚拟机，启动运行。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/run_1.jpg"
width="1280"
height="1045"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/run_1_hu_8dfcf83184292eda.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/run_1_hu_2d3edeacf2fe42bb.jpg 1024w"
loading="lazy"
alt="运行1"
class="gallery-image"
data-flex-grow="122"
data-flex-basis="293px"
>&lt;/p>
&lt;p>此时，鼠标可能无法使用，请使用 Tab键、方向键和回车键操作。&lt;/p>
&lt;p>顺利进入系统。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/run_2.jpg"
width="1275"
height="1051"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/run_2_hu_53a872e9a07b8f70.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/run_2_hu_33eff7abb6a2811b.jpg 1024w"
loading="lazy"
alt="运行2"
class="gallery-image"
data-flex-grow="121"
data-flex-basis="291px"
>&lt;/p>
&lt;hr>
&lt;h2 id="使用-winntsetup-快速制作-windows-l0-镜像">使用 WinNTSetup 快速制作 Windows L0 镜像
&lt;/h2>&lt;p>下载 &lt;a class="link" href="https://msfn.org/board/topic/149612-winntsetup-v533/" target="_blank" rel="noopener"
>WinNTSetup&lt;/a>。&lt;/p>
&lt;h3 id="vhdx-准备">vhdx 准备
&lt;/h3>&lt;p>参考之前步骤，完成虚拟磁盘的创建和分区。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="#%e5%88%9b%e5%bb%ba-vdhx" >创建 vdhx&lt;/a>，大小建议70G以上。&lt;/li>
&lt;li>&lt;a class="link" href="#%e5%88%86%e5%8c%ba" >分区&lt;/a>，卷标不用指定。&lt;/li>
&lt;/ul>
&lt;h3 id="制作过程中自动禁用虚拟磁盘扩充到最大">制作过程中自动禁用虚拟磁盘扩充到最大
&lt;/h3>&lt;p>在目录 &lt;code>WinNTSetup\RegTweaks\Win10&lt;/code> 下创建 &lt;code>disable-vdisk-expand.reg&lt;/code>。&lt;/p>
&lt;p>这个目录是安装过程中修改注册表的，可以利用此特性预置很多配置。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-reg" data-lang="reg">&lt;span class="line">&lt;span class="cl">Windows Registry Editor Version 5.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_LOCAL_MACHINE&lt;/span>&lt;span class="k">\SYSTEM\CurrentControlSet\Services\FsDepends\Parameters]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">&amp;#34;VirtualDiskExpandOnMount&amp;#34;&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">dword&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">00000004&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="使用-winntsetup-创建-l0-镜像">使用 WinNTSetup 创建 L0 镜像
&lt;/h3>&lt;p>打开 &lt;code>WinNTSetup&lt;/code>。&lt;/p>
&lt;ol>
&lt;li>选择 Windows 安装镜像 ISO，这里以 LSTC 为例。&lt;/li>
&lt;li>&lt;code>引导驱动器&lt;/code>选择虚拟磁盘的ESP分区，就是 FAT32 300MB 那个。&lt;/li>
&lt;li>&lt;code>系统驱动器&lt;/code>选择虚拟磁盘最大的那个分区，NTFS 那个。&lt;/li>
&lt;li>&lt;code>优化调整&lt;/code>里，&lt;code>注册表调整&lt;/code>选择&lt;code>Win10&lt;/code>，其余选项按需调整。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://alecthw.github.io/p/cloud-firmware-hyperv/winntsetup.jpg"
width="1706"
height="661"
srcset="https://alecthw.github.io/p/cloud-firmware-hyperv/winntsetup_hu_38a50a389e0d4b50.jpg 480w, https://alecthw.github.io/p/cloud-firmware-hyperv/winntsetup_hu_b351d9ca2fc38d13.jpg 1024w"
loading="lazy"
alt="winntsetup"
class="gallery-image"
data-flex-grow="258"
data-flex-basis="619px"
>&lt;/p>
&lt;p>最后点击 &lt;code>安装&lt;/code>，会提示&lt;code>不能选择VHD作为引导驱动器&lt;/code>，点击&lt;code>确定&lt;/code>继续即可。&lt;/p>
&lt;p>安装结束会提示&lt;code>重启&lt;/code>，就不用重启了。&lt;/p>
&lt;p>最后分离 VHD，一个 Windows 的 L0 镜像就做好了。&lt;/p></description></item><item><title>RouterOS CHR v7 UEFI 镜像，使用 Github Actions 构建</title><link>https://alecthw.github.io/p/routeros-uefi/</link><pubDate>Thu, 07 Dec 2023 17:11:11 +0800</pubDate><guid>https://alecthw.github.io/p/routeros-uefi/</guid><description>&lt;img src="https://alecthw.github.io/p/routeros-uefi/cover.png" alt="Featured image of post RouterOS CHR v7 UEFI 镜像，使用 Github Actions 构建" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;p>👉 需要的朋友自取。&lt;/p>
&lt;p>使用 Github Actions 构建，过程全透明，不存在后门的可能。官方镜像，&lt;code>非破解&lt;/code>。&lt;/p>
&lt;p>RouterOS chr-7.x 已经包含了 efi 启动文件，但是分区类型是 ext2。&lt;/p>
&lt;p>所以，只要把分区类型从 ext2 转成 fat 就可以从 uefi 引导启动了。&lt;/p>
&lt;p>当然，喜欢 GPT 的话，也可以制作 Hybrid MBR。&lt;/p>
&lt;h2 id="镜像下载">&lt;a class="link" href="https://github.com/alecthw/mikrotik-routeros-chr-efi/releases" target="_blank" rel="noopener"
>镜像下载&lt;/a>
&lt;/h2>&lt;p>👉 &lt;a class="link" href="https://github.com/alecthw/mikrotik-routeros-chr-efi/releases" target="_blank" rel="noopener"
>Release&lt;/a> 👈&lt;/p>
&lt;p>👉 &lt;a class="link" href="https://www.right.com.cn/forum/thread-8271574-1-1.html" target="_blank" rel="noopener"
>破解版传送门&lt;/a> 👈&lt;/p>
&lt;p>包含的镜像类型：&lt;/p>
&lt;ul>
&lt;li>img&lt;/li>
&lt;li>qcow2&lt;/li>
&lt;li>vdi&lt;/li>
&lt;li>vhd&lt;/li>
&lt;li>vhdx&lt;/li>
&lt;li>vmdk&lt;/li>
&lt;/ul>
&lt;h2 id="hybrid-mbr-记录">Hybrid MBR 记录
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="c1"># use GPT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> t &lt;span class="c1"># change partition code&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="c1"># select first partition&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="m">8300&lt;/span> &lt;span class="c1"># change code to Linux filesystem 8300&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> r &lt;span class="c1"># Recovery/transformation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> h &lt;span class="c1"># Hybrid MBR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="c1"># partitions added to the hybrid MBR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> n &lt;span class="c1"># Place EFI GPT (0xEE) partition first in MBR (good for GRUB)? (Y/N)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="c1"># Enter an MBR hex code (default 83)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> y &lt;span class="c1"># Set the bootable flag? (Y/N)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="c1"># Enter an MBR hex code (default 83)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> n &lt;span class="c1"># Set the bootable flag? (Y/N)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> n &lt;span class="c1"># Unused partition space(s) found. Use one to protect more partitions? (Y/N)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> w &lt;span class="c1"># write changes to disk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> y &lt;span class="c1"># confirm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">)&lt;/span> &lt;span class="p">|&lt;/span> sudo -E gdisk /dev/nbd1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Vxlan 是否能让 GFW 放松一点？Vxlan 搭建科学上网实验</title><link>https://alecthw.github.io/p/fuck-gfw-vxlan/</link><pubDate>Fri, 01 Dec 2023 22:09:55 +0800</pubDate><guid>https://alecthw.github.io/p/fuck-gfw-vxlan/</guid><description>&lt;img src="https://alecthw.github.io/p/fuck-gfw-vxlan/cover.png" alt="Featured image of post Vxlan 是否能让 GFW 放松一点？Vxlan 搭建科学上网实验" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;p>VXLAN（Virtual eXtensible Local Area Network，虚拟扩展局域网），是由 IETF 定义的 NVO3（Network Virtualization over Layer 3）标准技术之一，是对传统 VLAN 协议的一种扩展。VXLAN 的特点是将 L2 的以太帧封装到 UDP 报文（即 L2 over L4）中，并在 L3 网络中传输。&lt;/p>
&lt;p>VXLAN 本质上是一种隧道技术，在源网络设备与目的网络设备之间的 IP 网络上，建立一条逻辑隧道，将用户侧报文经过特定的封装后通过这条隧道转发。&lt;/p>
&lt;p>关于 VXLAN，这里不展开讲，只需要知道两点：&lt;/p>
&lt;ol>
&lt;li>它是一种隧道技术&lt;/li>
&lt;li>它在公有云中被广泛应用&lt;/li>
&lt;/ol>
&lt;p>更深入的了解，可以参考&lt;a class="link" href="https://support.huawei.com/enterprise/zh/doc/EDOC1100087027" target="_blank" rel="noopener"
>什么是 VXLAN&lt;/a>。&lt;/p>
&lt;p>既然是隧道，就可以用它来整活儿。由于被公有云广泛应用，猜测 GFW 对它的审查应该有所放松。记得曾经在某公司云服务的一场会议上，听其高管讲，共有云的跨国流量里，80% 的流量都是非法业务。&lt;/p>
&lt;p>既如此，如果用 VXLAN 来科学上网，效果会不会不错？&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">先说结论吧：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- 直接把 VXLAN 作为隧道翻墙是不可行的，经测试，由于 VXLAN 并不加密，GFW 的审查应该是会剥离 VXLAN 头部直接审查内部报文。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- 所以，即使经过了 VXLAN 隧道，把 VPS 作为网关，访问情况和国内直接访问一致。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="网络规划">网络规划
&lt;/h2>&lt;p>整体思路就是旁路由的思路，直接上图：&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/fuck-gfw-vxlan/network.jpg"
width="996"
height="307"
srcset="https://alecthw.github.io/p/fuck-gfw-vxlan/network_hu_df4b8f307eeae8d7.jpg 480w, https://alecthw.github.io/p/fuck-gfw-vxlan/network_hu_3046cdd7db5239f5.jpg 1024w"
loading="lazy"
alt="network"
class="gallery-image"
data-flex-grow="324"
data-flex-basis="778px"
>&lt;/p>
&lt;p>划重点：&lt;/p>
&lt;ol>
&lt;li>VXLAN 是要双向配置的，所以本地和远端都必须是公网IP。&lt;/li>
&lt;li>本地使用 RouterOS 7，当时起个 Liunx 也可以，用 ROS 主要是为了方便配置策略路由来分流。&lt;/li>
&lt;/ol>
&lt;h2 id="开始配置">开始配置
&lt;/h2>&lt;p>以下涉及到公网的 IP 的，使用 &lt;code>x&lt;/code> 替换了一部分，复制命令时请自行替换。&lt;/p>
&lt;p>这里是新拉起了一个 Linode VPS 作为远端服务器，系统使用的是 Ubuntu 22.04。&lt;/p>
&lt;h3 id="vps-准备工作">VPS 准备工作
&lt;/h3>&lt;h4 id="1-禁用防火墙">1. 禁用防火墙
&lt;/h4>&lt;p>既然是实验，先禁用防火墙，避免其可能的影响。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl stop ufw.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl disable ufw.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-开启转发">2. 开启转发
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vim /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>取消以下两行的注释&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">net.ipv4.ip_forward=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv6.conf.all.forwarding=1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>再执行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sysctl -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="routeros-准备工作">RouterOS 准备工作
&lt;/h3>&lt;p>RouterOS 的配置就不截 winbox 配置界面的图了，命令行和界面基本都能对上，直接贴命令行了。&lt;/p>
&lt;h4 id="1-ip服务的安全策略先加上避免被爆破导致控制台疯狂输出登录失败日志">1. IP服务的安全策略先加上，避免被爆破，导致控制台疯狂输出登录失败日志
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/ip service &lt;span class="nb">set&lt;/span> telnet &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ip service &lt;span class="nb">set&lt;/span> ftp &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ip service &lt;span class="nb">set&lt;/span> www &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ip service &lt;span class="nb">set&lt;/span> ssh &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ip service &lt;span class="nb">set&lt;/span> www-ssl &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ip service &lt;span class="nb">set&lt;/span> api &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ip service &lt;span class="nb">set&lt;/span> winbox &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ip service &lt;span class="nb">set&lt;/span> api-ssl &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="2-配置上网这里是-pppoe-拨号">2. 配置上网，这里是 PPPOE 拨号
&lt;/h4>&lt;p>修改下接口名字&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/interface ethernet &lt;span class="nb">set&lt;/span> &lt;span class="o">[&lt;/span> find default-name&lt;span class="o">=&lt;/span>ether1 &lt;span class="o">]&lt;/span> &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>ether1-wan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/interface ethernet &lt;span class="nb">set&lt;/span> &lt;span class="o">[&lt;/span> find default-name&lt;span class="o">=&lt;/span>ether2 &lt;span class="o">]&lt;/span> &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>ether2-lan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置 PPPOE&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/interface pppoe-client add &lt;span class="nv">interface&lt;/span>&lt;span class="o">=&lt;/span>ether2-wan &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>pppoe-wan &lt;span class="nv">user&lt;/span>&lt;span class="o">=&lt;/span>&amp;lt;user&amp;gt; &lt;span class="nv">password&lt;/span>&lt;span class="o">=&lt;/span>&amp;lt;password&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置 DNS&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/ip dns &lt;span class="nb">set&lt;/span> allow-remote-requests&lt;span class="o">=&lt;/span>yes &lt;span class="nv">servers&lt;/span>&lt;span class="o">=&lt;/span>223.5.5.5,114.114.114.114
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置检查">配置检查
&lt;/h3>&lt;h4 id="本地-ros-ping-vps">本地 ROS ping VPS
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@rostest&lt;span class="o">]&lt;/span> &amp;gt; ping 172.233.142.x
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SEQ HOST SIZE TTL TIME STATUS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">0&lt;/span> 172.233.142.x &lt;span class="m">56&lt;/span> &lt;span class="m">47&lt;/span> 184ms440us
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> 172.233.142.x &lt;span class="m">56&lt;/span> &lt;span class="m">47&lt;/span> 184ms340us
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">2&lt;/span> 172.233.142.x &lt;span class="m">56&lt;/span> &lt;span class="m">47&lt;/span> 184ms235us
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">sent&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">received&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> packet-loss&lt;span class="o">=&lt;/span>0% min-rtt&lt;span class="o">=&lt;/span>184ms235us avg-rtt&lt;span class="o">=&lt;/span>184ms338us max-rtt&lt;span class="o">=&lt;/span>184ms440u
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以看到网络是通的。&lt;/p>
&lt;h4 id="vps-ping-本地-ros-的公网-ip">VPS ping 本地 ROS 的公网 IP
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@localhost:~# ping 121.229.x.x
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 121.229.x.x &lt;span class="o">(&lt;/span>121.229.x.x&lt;span class="o">)&lt;/span> 56&lt;span class="o">(&lt;/span>84&lt;span class="o">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 121.229.x.x: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">40&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">186&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 121.229.x.x: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">40&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">186&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 121.229.x.x: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">40&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">186&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 121.229.x.x ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">3&lt;/span> packets transmitted, &lt;span class="m">3&lt;/span> received, 0% packet loss, &lt;span class="nb">time&lt;/span> 2002ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev &lt;span class="o">=&lt;/span> 185.582/185.879/186.073/0.213 ms
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以看到网络是通的。&lt;/p>
&lt;h3 id="vxlan-vps-配置">VXLAN: VPS 配置
&lt;/h3>&lt;p>以下分别为命令行和 netplan 的配置。&lt;/p>
&lt;h4 id="命令行">命令行
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ip link add vxlan0 &lt;span class="nb">type&lt;/span> vxlan &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> id &lt;span class="m">3000&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> remote 121.229.x.x &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> dstport &lt;span class="m">4789&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="nb">local&lt;/span> 172.233.142.x &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> dev eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip link &lt;span class="nb">set&lt;/span> vxlan0 up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip addr add 192.168.99.2/24 dev vxlan0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看 vxlan0 接口&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@localhost:~# ifconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vxlan0: &lt;span class="nv">flags&lt;/span>&lt;span class="o">=&lt;/span>4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt; mtu &lt;span class="m">1450&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 192.168.99.2 netmask 255.255.255.0 broadcast 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::ec90:6ff:fe88:372d prefixlen &lt;span class="m">64&lt;/span> scopeid 0x20&amp;lt;link&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ether ee:90:06:88:37:2d txqueuelen &lt;span class="m">1000&lt;/span> &lt;span class="o">(&lt;/span>Ethernet&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RX packets &lt;span class="m">0&lt;/span> bytes &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0.0 B&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RX errors &lt;span class="m">0&lt;/span> dropped &lt;span class="m">0&lt;/span> overruns &lt;span class="m">0&lt;/span> frame &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TX packets &lt;span class="m">8&lt;/span> bytes &lt;span class="m">544&lt;/span> &lt;span class="o">(&lt;/span>544.0 B&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TX errors &lt;span class="m">0&lt;/span> dropped &lt;span class="m">0&lt;/span> overruns &lt;span class="m">0&lt;/span> carrier &lt;span class="m">0&lt;/span> collisions &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看路由表，多了下面的内容，所有目的地址是 192.168.99.0/24 网络包要通过 vxlan0 转发：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@localhost:~# ip route show
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.99.0/24 dev vxlan0 proto kernel scope link src 192.168.99.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看 fdb。这个表项的意思是，默认的 VTEP 对端地址为 121.229.x.x。换句话说，原始报文经过 vxlan0 后会被内核添加上 VXLAN 头部，而外部 UDP 头的目的 IP 地址会被冠上 121.229.x.x。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@localhost:~# bridge fdb show
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">00:00:00:00:00:00 dev vxlan0 dst 121.229.x.x via eth0 self permanent
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="netplan-配置文件">netplan 配置文件
&lt;/h4>&lt;p>命令行配置重启后会失效，放到 netplan 里配置持久化。&lt;/p>
&lt;p>&lt;code>/etc/netplan/99-vxlan-config.yaml&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">network&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tunnels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vxlan0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">vxlan&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">local&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">172.233.142&lt;/span>&lt;span class="l">.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">remote&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">121.229&lt;/span>&lt;span class="l">.x.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">3000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">4789&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addresses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">192.168.99.2&lt;/span>&lt;span class="l">/24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="vxlan-本地-ros-配置">VXLAN: 本地 ROS 配置
&lt;/h3>&lt;p>先创建 VXLAN，然后再把 VXLAN 接口和 LAN 口桥接。&lt;/p>
&lt;h4 id="创建-vxlan">创建 VXLAN
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/interface vxlan add &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>vxlan0 &lt;span class="nv">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4789&lt;/span> &lt;span class="nv">vni&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/interface vxlan vteps add &lt;span class="nv">interface&lt;/span>&lt;span class="o">=&lt;/span>vxlan0 remote-ip&lt;span class="o">=&lt;/span>172.233.142.x
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="桥接-vxlan0-和-ether2-lan">桥接 vxlan0 和 ether2-lan
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/interface bridge add &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>br-lan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/interface bridge port add &lt;span class="nv">bridge&lt;/span>&lt;span class="o">=&lt;/span>br-lan &lt;span class="nv">interface&lt;/span>&lt;span class="o">=&lt;/span>ether2-lan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/interface bridge port add &lt;span class="nv">bridge&lt;/span>&lt;span class="o">=&lt;/span>br-lan &lt;span class="nv">interface&lt;/span>&lt;span class="o">=&lt;/span>vxlan0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="br-lan-配置-ip">br-lan 配置 IP
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/ip address add &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>192.168.99.1/24 &lt;span class="nv">interface&lt;/span>&lt;span class="o">=&lt;/span>br-lan &lt;span class="nv">network&lt;/span>&lt;span class="o">=&lt;/span>192.168.99.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里配置的 IP 和 VPS 上给 vxlan0 接口配置的 IP 是相同网段的。&lt;/p>
&lt;h3 id="测试-vxlan-隧道">测试 VXLAN 隧道
&lt;/h3>&lt;p>在 VPS 上 ping ROS 的 br-lan 接口的 IP&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@localhost:~# ping 192.168.99.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 192.168.99.1 &lt;span class="o">(&lt;/span>192.168.99.1&lt;span class="o">)&lt;/span> 56&lt;span class="o">(&lt;/span>84&lt;span class="o">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 192.168.99.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">144&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 192.168.99.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">144&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 192.168.99.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">144&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 192.168.99.1 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">3&lt;/span> packets transmitted, &lt;span class="m">3&lt;/span> received, 0% packet loss, &lt;span class="nb">time&lt;/span> 2003ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev &lt;span class="o">=&lt;/span> 144.359/144.400/144.446/0.035 ms
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 ROS 上 ping VPS 的 vxlan0 接口的 IP&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@rostest&lt;span class="o">]&lt;/span> &amp;gt; ping 192.168.99.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SEQ HOST SIZE TTL TIME STATUS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">0&lt;/span> 192.168.99.2 &lt;span class="m">56&lt;/span> &lt;span class="m">64&lt;/span> 144ms271us
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> 192.168.99.2 &lt;span class="m">56&lt;/span> &lt;span class="m">64&lt;/span> 144ms647us
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">2&lt;/span> 192.168.99.2 &lt;span class="m">56&lt;/span> &lt;span class="m">64&lt;/span> 144ms309us
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">sent&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">received&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> packet-loss&lt;span class="o">=&lt;/span>0% min-rtt&lt;span class="o">=&lt;/span>144ms271us g-rtt&lt;span class="o">=&lt;/span>144ms409us max-rtt&lt;span class="o">=&lt;/span>144ms647us
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以看到，VXLAN 已经互通了。&lt;/p>
&lt;p>在 VPS 上再查看一下 fdb，可以看到，本地网络的一些 MAC 地址已经学习过来了，摘取了部分：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">00:00:00:00:00:00 dev vxlan0 dst 121.229.x.x self permanent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ac:82:26:xx:xx:xx dev vxlan0 dst 121.229.x.x self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">26:99:ac:xx:xx:xx dev vxlan0 dst 121.229.x.x self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">98:3f:60:xx:xx:xx dev vxlan0 dst 121.229.x.x self
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="在-vps-上配置-snat">在 VPS 上配置 snat
&lt;/h3>&lt;p>源地址 NAT 不多说了，不明白的自己查。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">iptables -t nat &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -A POSTROUTING &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -s 192.168.99.0/24 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -o eth0 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -j SNAT &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --to-source 172.233.142.x
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置完查看下，确保配置成功&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@localhost:~# iptables -nL -t nat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Chain POSTROUTING &lt;span class="o">(&lt;/span>policy ACCEPT&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">target prot opt &lt;span class="nb">source&lt;/span> destination
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SNAT all -- 192.168.99.0/24 0.0.0.0/0 to:172.233.142.x
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="pc-上网测试">PC 上网测试
&lt;/h2>&lt;p>把本地电脑的网络配置成：&lt;/p>
&lt;ul>
&lt;li>地址: 192.168.99.200&lt;/li>
&lt;li>掩码: 255.255.255.0&lt;/li>
&lt;li>网关: 192.168.99.2&lt;/li>
&lt;li>DNS: 8.8.8.8&lt;/li>
&lt;/ul>
&lt;p>在 VPS 上 ping 一下 &lt;code>192.168.99.200&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@localhost:~# ping 192.168.99.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 192.168.99.200 &lt;span class="o">(&lt;/span>192.168.99.200&lt;span class="o">)&lt;/span> 56&lt;span class="o">(&lt;/span>84&lt;span class="o">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 192.168.99.200: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">128&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">145&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 192.168.99.200: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">128&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">144&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 192.168.99.200: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">128&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">143&lt;/span> ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 192.168.99.200 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">3&lt;/span> packets transmitted, &lt;span class="m">3&lt;/span> received, 0% packet loss, &lt;span class="nb">time&lt;/span> 1998ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev &lt;span class="o">=&lt;/span> 143.159/144.091/144.858/0.703 ms
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以看到，VPS 和本地 PC 已经连通，并且还是相同网段的二层域。&lt;/p>
&lt;p>打开浏览器，打开 &lt;a class="link" href="https://ip.skk.moe/" target="_blank" rel="noopener"
>https://ip.skk.moe/&lt;/a> 测试下。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/fuck-gfw-vxlan/test-result.jpg"
width="888"
height="819"
srcset="https://alecthw.github.io/p/fuck-gfw-vxlan/test-result_hu_23bb33438e0f0331.jpg 480w, https://alecthw.github.io/p/fuck-gfw-vxlan/test-result_hu_38c0b15725f2c2e8.jpg 1024w"
loading="lazy"
alt="test-result"
class="gallery-image"
data-flex-grow="108"
data-flex-basis="260px"
>&lt;/p>
&lt;p>从图中可知，IP 地址已经是 VPS 的公网IP，但是访问阻断情况和国内直接访问一致，并且还额外导致百度无法访问。&lt;/p>
&lt;p>再次测试，例如 Apple 等未被 GFW 封锁的网站都是可以正常访问的。&lt;/p>
&lt;p>&lt;img src="https://alecthw.github.io/p/fuck-gfw-vxlan/Apple.jpg"
width="1352"
height="824"
srcset="https://alecthw.github.io/p/fuck-gfw-vxlan/Apple_hu_e7a9388e0198f783.jpg 480w, https://alecthw.github.io/p/fuck-gfw-vxlan/Apple_hu_f628914690908ee6.jpg 1024w"
loading="lazy"
alt="Apple"
class="gallery-image"
data-flex-grow="164"
data-flex-basis="393px"
>&lt;/p>
&lt;p>由此可见：由于 VXLAN 并不加密，GFW 的审查应该是会剥离 VXLAN 头部直接审查内部报文，所以访问阻断的结果和国内一致。&lt;/p>
&lt;h2 id="结论">结论
&lt;/h2>&lt;ol>
&lt;li>GFW 对 VXLAN 并不会放松审查，但是猜测：VXLAN 报文中含有被阻断的域名、IP，并不会直接导致 GFW 封锁 VPS 的 IP。&lt;/li>
&lt;li>由第1点，或许可以采用 VXLAN 报文作为外层包装，从而达到保护 VPS IP 的目的。毕竟各大机场基本都是通过国内公有云中转，而中转流量很大一部分应该跑在 VXLAN 之上。&lt;/li>
&lt;li>VXLAN 对性能的损失非常小，但由于 VXLAN 的配置需要双向公网 IP，没有公网 IP 的情况下，使用起来有两个思路：
&lt;ol>
&lt;li>作为外层包装协议，并不实际创建 VXLAN 隧道；&lt;/li>
&lt;li>使用国内公有云中转，国内外 VPS 直接配置 VXLAN 隧道；&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol></description></item><item><title>在 Hugo Stack 中集成 Mermaid 和 MarkMap</title><link>https://alecthw.github.io/p/hugo-diagrams/</link><pubDate>Wed, 19 Apr 2023 21:59:22 +0800</pubDate><guid>https://alecthw.github.io/p/hugo-diagrams/</guid><description>&lt;img src="https://alecthw.github.io/p/hugo-diagrams/cover.jpg" alt="Featured image of post 在 Hugo Stack 中集成 Mermaid 和 MarkMap" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;p>集成参考了 Google 的 &lt;a class="link" href="https://github.com/google/docsy" target="_blank" rel="noopener"
>docsy&lt;/a> 中的集成方式。&lt;/p>
&lt;p>主题 &lt;a class="link" href="https://stack.jimmycai.com/" target="_blank" rel="noopener"
>hugo-theme-stack&lt;/a> 中没有集成 Mermaid，仅集成了 Katex，需要画图的时候就要自己引入 Mermaid 。&lt;/p>
&lt;p>由于使用 module 的方式使用主题，故并不想因为为了引入 Mermaid 而修改主题模板。Stack 提供了两个空的模板来支持自定义，所以就通过这两个自定义模板来引入。&lt;/p>
&lt;ul>
&lt;li>&lt;code>layouts/partials/head/custom.html&lt;/code>&lt;/li>
&lt;li>&lt;code>layouts/partials/footer/custom.html&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>另外，为了方便后续维护，也同时使用 &lt;a class="link" href="https://github.com/google/docsy" target="_blank" rel="noopener"
>docsy&lt;/a> 里的方式引入了 Katex。&lt;/p>
&lt;h2 id="集成方式">集成方式
&lt;/h2>&lt;p>主要的工作是添加钩子模板和引入相关的JavaScript文件。&lt;/p>
&lt;h3 id="新增文件">新增文件
&lt;/h3>&lt;p>将&lt;a class="link" href="https://github.com/alecthw/alecthw.github.io" target="_blank" rel="noopener"
>本项目&lt;/a>中的以下文件，直接拷贝到你的项目中。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 钩子模板&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">layouts/_default/_markup/render-codeblock-chem.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">layouts/_default/_markup/render-codeblock-markmap.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">layouts/_default/_markup/render-codeblock-math.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">layouts/_default/_markup/render-codeblock-mermaid.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 主题可自定义的模板文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">layouts/partials/head/custom.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">layouts/partials/footer/custom.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># JavaScript文件集中引入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">layouts/partials/scripts.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># JavaScript文件和CSS文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">assets/js/markmap.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">assets/js/mermaid.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">static/js/prism.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">static/css/prism.css
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="新增相关配置">新增相关配置
&lt;/h3>&lt;p>config_default\params.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">markmap&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">mermaid&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">theme&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">flowchart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">diagramPadding&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">20&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">katex&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mhchem&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>PS: 如果不是使用的&lt;code>Configuration Directory&lt;/code>，要把配置加到&lt;code>params&lt;/code>下。&lt;/p>
&lt;h2 id="使用示例">使用示例
&lt;/h2>&lt;h3 id="mermaid">Mermaid
&lt;/h3>&lt;pre class="mermaid">graph TD;
A--&amp;gt;B;
A--&amp;gt;C;
B--&amp;gt;D;
C--&amp;gt;D;&lt;/pre>
&lt;h3 id="markmap">MarkMap
&lt;/h3>&lt;pre class="markmap"># markmap
## Links
- &amp;lt;https://markmap.js.org/&amp;gt;
- [GitHub](https://github.com/gera2ld/markmap)
## Related
- [coc-markmap](https://github.com/gera2ld/coc-markmap)
- [gatsby-remark-markmap](https://github.com/gera2ld/gatsby-remark-markmap)
## Features
- links
- **inline** ~~text~~ *styles*
- multiline
text
- `inline code`
-
```js
console.log(&amp;#39;code block&amp;#39;);
```
- Katex - $x = {-b \pm \sqrt{b^2-4ac} \over 2a}$&lt;/pre>
&lt;h3 id="mathjax">Mathjax
&lt;/h3>&lt;p>行间公式：&lt;/p>
$$\sum_{i=0}N\int_{a}{b}g(t,i)\text{d}t$$&lt;p>行内公式：\(y=ax+b\)&lt;/p>
&lt;p>&lt;code>math&lt;/code> 代码块：&lt;/p>
&lt;div class="math">$$\tag*{(1)} P(E) = {n \choose k} p^k (1-p)^{n-k}$$&lt;/div>&lt;h3 id="mhchem">mhchem
&lt;/h3>
&lt;div class="chem">$$\tag*{(2)} \ce{Zn^2+ &lt;=>[+ 2OH-][+ 2H+] $\underset{\text{amphoteric hydroxide}}{\ce{Zn(OH)2 v}}$ &lt;=>[+ 2OH-][+ 2H+] $\underset{\text{tetrahydroxozincate}}{\ce{[Zn(OH)4]^2-}}$}$$&lt;/div></description></item><item><title>V2Ray4.x + Nginx + TLS + ws + MTProto 详细配置教程</title><link>https://alecthw.github.io/p/v2ray-tutorial/</link><pubDate>Sun, 18 Nov 2018 13:32:58 +0800</pubDate><guid>https://alecthw.github.io/p/v2ray-tutorial/</guid><description>&lt;img src="https://alecthw.github.io/p/v2ray-tutorial/cover.png" alt="Featured image of post V2Ray4.x + Nginx + TLS + ws + MTProto 详细配置教程" />&lt;p>🔥🔥🔥：稳定好用的机场/梯子 &lt;a class="link" href="https://558343.dedicated-afflink.com/#/auth/2neqgxFl" target="_blank" rel="noopener"
>TAG 全球250+节点、99+流媒体解锁&lt;/a>，更多参考&lt;a class="link" href="https://alecthw.github.io/p/airport-recommend/" >机场推荐&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="前言">前言
&lt;/h2>&lt;p>当前 V2Ray 应该算是比较好用的翻墙软件，和 ss、ssr 相比还是很稳定的，不容易被检测，尤其是加上 Nginx 和 TLS，再做个简单的网站顶在前面，完全伪造成了一个正常的网页访问行为，非常安全可靠，并且具有很强的抗检测能力。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;em>必须会简单使用 Linux 命令行，即 Shell&lt;/em>&lt;/strong>&lt;/li>
&lt;li>&lt;strong>&lt;em>以下示例中的域名均为&lt;code>www.example.cc&lt;/code>，域名、UUID 以及 MTProto 的密钥请记得替换成自己的&lt;/em>&lt;/strong>&lt;/li>
&lt;li>有耐心、喜欢折腾或者想自己学点东西的就往下看&lt;/li>
&lt;li>没耐心的可以去用机场或者一键脚本&lt;/li>
&lt;li>这是针对学生和工薪阶层且有科学上网需求的同志，土豪请直接用机场去吧（比如&lt;a class="link" href="https://rixcloud.me/" target="_blank" rel="noopener"
>外号 richCloud 的 rixCloud&lt;/a>）&lt;/li>
&lt;/ul>
&lt;h3 id="参考文档">参考文档
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.v2ray.com/" target="_blank" rel="noopener"
>V2Ray 官方文档&lt;/a>
&lt;a class="link" href="https://toutyrater.github.io/" target="_blank" rel="noopener"
>V2Ray 白话文教程&lt;/a>
&lt;a class="link" href="https://github.com/TelegramMessenger/MTProxy" target="_blank" rel="noopener"
>MTProxy 官方文档&lt;/a>&lt;/p>
&lt;h3 id="涉及的内容">涉及的内容
&lt;/h3>&lt;pre class="mermaid">graph LR
subgraph V2Ray
v2rayws[V2Ray WebSocket]
v2raytg[V2Ray MTProto]
end
free((WAN))
rep(外部请求) --&amp;gt; in[Nginx]
in -- / --&amp;gt; web[腾讯公益404]
in -- /wss --&amp;gt; v2rayws
v2rayws --&amp;gt; free
tgc(Telegram Client) --&amp;gt; v2raytg
v2raytg --&amp;gt; free&lt;/pre>
&lt;ol>
&lt;li>域名申请；&lt;/li>
&lt;li>Let&amp;rsquo;s Encrypt 申请 SSL 证书；&lt;/li>
&lt;li>Nginx 作为前置服务配置 web 主页；&lt;/li>
&lt;li>通过配置 Nginx 反向代理访问后面的 v2ray 服务；&lt;/li>
&lt;li>v2ray 同时提供 mtproto 服务；&lt;/li>
&lt;li>使用腾讯公益 404 作为 web 主页；&lt;/li>
&lt;/ol>
&lt;h3 id="大致的步骤">大致的步骤
&lt;/h3>&lt;ol>
&lt;li>准备服务器；&lt;/li>
&lt;li>申请域名；&lt;/li>
&lt;li>创建网站根目录；&lt;/li>
&lt;li>安装 Nginx；&lt;/li>
&lt;li>获得 SSL 证书；&lt;/li>
&lt;li>修改 Nginx 配置支持 Https；&lt;/li>
&lt;li>安装启动 V2Ray；&lt;/li>
&lt;/ol>
&lt;h2 id="安装部署">安装部署
&lt;/h2>&lt;h3 id="端口规划">端口规划
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port&lt;/th>
&lt;th>Listen IP&lt;/th>
&lt;th>Use&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>80&lt;/td>
&lt;td>0.0.0.0&lt;/td>
&lt;td>Nginx Http&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>443&lt;/td>
&lt;td>0.0.0.0&lt;/td>
&lt;td>Nginx Https&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>10443&lt;/td>
&lt;td>127.0.0.1&lt;/td>
&lt;td>V2Ray WebSocket&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>8080&lt;/td>
&lt;td>0.0.0.0&lt;/td>
&lt;td>V2Ray MTProto&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="服务器准备">服务器准备
&lt;/h3>&lt;p>拿来翻墙用的服务器，肯定是本着便宜好用性价比高的原则来选择。&lt;a class="link" href="https://bwh8.net/" target="_blank" rel="noopener"
>搬瓦工&lt;/a>毕竟有 cn2 和 cn2 gia 线路，价格也算是最便宜的，重点可以支付宝支付，还是选择搬瓦工吧。&lt;/p>
&lt;p>逢年过节，搬瓦工都会推出特别款优惠主机，比如双十一、黑五，性价比极高！可以关注下。&lt;/p>
&lt;h4 id="bandwagonhost-套餐选择">BandwagonHost 套餐选择
&lt;/h4>&lt;p>搬瓦工套餐很多，相同配置不同价格排序如下：
&lt;code>普通线路 &amp;lt; CN2线路 &amp;lt; CN2 GIA线路&lt;/code>
一般情况下个人使用或者家用的话，最便宜的套餐足以，不常看视频，一个月流量在 100-200GB。&lt;/p>
&lt;p>注册购买什么的就不赘述了，现在上过学都看得懂英文。&lt;/p>
&lt;p>根据自己的需求选择相应的配置即可，避免浪费。&lt;/p>
&lt;ul>
&lt;li>访问谷歌，简单的网页访问需求&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">10G VZ - PROMO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SSD: 10 GB RAID-10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAM: 512 MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU: 1x Intel Xeon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transfer: 500 GB/mo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Link speed: 1 Gigabit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>19.99 美刀一年，只能年付。
OpenVZ 架构，唯一的优势就是便宜。高峰期对主机性能和网络都有影响。&lt;/p>
&lt;ul>
&lt;li>偶尔看看视频，比如油管&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">SPECIAL 10G KVM PROMO V3 - LOS ANGELES - CN2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SSD: 10 GB RAID-10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAM: 512 MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU: 1x Intel Xeon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transfer: 500 GB/mo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Link speed: 1 Gigabit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>29.99 美刀一年，只能年付。&lt;strong>&lt;em>一般人建议买这个&lt;/em>&lt;/strong>。
KVM 架构，延迟勉强，&lt;code>170ms&lt;/code>左右，油管 4K 撑得住。高峰期对网络有一定影响。&lt;/p>
&lt;ul>
&lt;li>强烈视频需求，打游戏，需要低延迟网络&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">SPECIAL 10G KVM PROMO V3 - LOS ANGELES - CN2 GIA - LIMITED EDITION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Limited stock available**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SSD: 10 GB RAID-10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAM: 512 MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU: 1x Intel Xeon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transfer: 300 GB/mo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Link speed: 1 Gigabit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>39.99 美刀一年，只能年付。此套餐经常缺货，想买的需要关注，有钱可以买上一级套餐（可季付、半年付、年付）。&lt;/p>
&lt;p>同样 KVM 架构，延迟比 cn2 略低，油管 4K 撑得住。高峰期对网络影响较小。&lt;/p>
&lt;h4 id="准备软件">准备软件
&lt;/h4>&lt;p>1、 &lt;a class="link" href="https://mobaxterm.mobatek.net/" target="_blank" rel="noopener"
>MobaXterm&lt;/a>: SSH 客户端工具，集成了 SFTP，安装免费版即可
2、 &lt;a class="link" href="https://code.visualstudio.com/" target="_blank" rel="noopener"
>Visual Studio Code&lt;/a>: 编辑器，主要拿来编辑 Nginx 的配置文件和 V2ray 的配置文件，支持 JSON 代码高亮，避免配置文件编写错误&lt;/p>
&lt;h4 id="配置服务器">配置服务器
&lt;/h4>&lt;p>这里以搬瓦工为例。&lt;/p>
&lt;h5 id="更换操作系统">更换操作系统
&lt;/h5>&lt;p>建议选择 CentOS7 吧，方便好用。如果是 KVM 架构的机器，还能选择支持 bbr 的操作 CentOS。这里以 CN2 GIA 的服务器为例。&lt;/p>
&lt;p>&lt;strong>&lt;em>以下命令均以 CentOS7 下的命令为例&lt;/em>&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>登录搬瓦工&lt;code>Client Area&lt;/code>，点&lt;code>Services -&amp;gt; My Services&lt;/code>查看自己的所有服务&lt;/li>
&lt;li>点击对应&lt;code>Product/Service&lt;/code>后面的&lt;code>KiwiVM Control Panel&lt;/code>按钮进入控制台
&lt;img src="https://alecthw.github.io/p/v2ray-tutorial/config_server_1.JPG"
width="977"
height="86"
srcset="https://alecthw.github.io/p/v2ray-tutorial/config_server_1_hu_ddbb696fd3b34419.JPG 480w, https://alecthw.github.io/p/v2ray-tutorial/config_server_1_hu_be220b58e544399.JPG 1024w"
loading="lazy"
alt="config_server_1"
class="gallery-image"
data-flex-grow="1136"
data-flex-basis="2726px"
>&lt;/li>
&lt;li>首先将虚拟机关机，关机后才能重装系统
&lt;img src="https://alecthw.github.io/p/v2ray-tutorial/config_server_2.JPG"
width="935"
height="435"
srcset="https://alecthw.github.io/p/v2ray-tutorial/config_server_2_hu_6b80f4a8c859574.JPG 480w, https://alecthw.github.io/p/v2ray-tutorial/config_server_2_hu_18ad3500fa578e3c.JPG 1024w"
loading="lazy"
alt="config_server_2"
class="gallery-image"
data-flex-grow="214"
data-flex-basis="515px"
>&lt;/li>
&lt;li>选择&lt;code>Install new OS&lt;/code>，然后选择&lt;code>&amp;quot;centos-7-x86_64-bbr&amp;quot;&lt;/code>，勾选&lt;code>&amp;quot;I agree ...&amp;quot;&lt;/code>，点&lt;code>Reload&lt;/code>重新安装
&lt;img src="https://alecthw.github.io/p/v2ray-tutorial/config_server_3.JPG"
width="940"
height="477"
srcset="https://alecthw.github.io/p/v2ray-tutorial/config_server_3_hu_68c0541c1ae41815.JPG 480w, https://alecthw.github.io/p/v2ray-tutorial/config_server_3_hu_a5a3314837e57c75.JPG 1024w"
loading="lazy"
alt="config_server_3"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="472px"
>&lt;/li>
&lt;li>&lt;strong>&lt;em>记下 root 密码和端口号备用&lt;/em>&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h5 id="更改服务器密码">更改服务器密码
&lt;/h5>&lt;p>使用 MobaXterm（或者其他 SSH 工具），使用刚刚的密码和端口号登录服务器，注意下&lt;strong>端口号&lt;/strong>，搬瓦工的 SSH 不是默认 22 端口。
登录后执行&lt;code>passwd&lt;/code>，然后输入两遍新密码即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ passwd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changing password &lt;span class="k">for&lt;/span> user root.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">New password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Retype new password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd: all authentication tokens updated successfully.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="更新系统">更新系统
&lt;/h5>&lt;p>搬瓦工自带的 epel 总觉得缺包，所以卸载重新安装下。
同时需要安装下 vim、git、zip 和 unzip。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">yum remove -y epel-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yum install -y epel-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yum update -y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yum install -y vim git zip unzip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="申请域名">申请域名
&lt;/h4>&lt;p>由于要使用 TLS，所以需要一个域名。建议注册&lt;code>.cc&lt;/code>结尾的域名，便宜并且不需要实名认证。
传送门：&lt;a class="link" href="https://wanwang.aliyun.com/" target="_blank" rel="noopener"
>https://wanwang.aliyun.com/&lt;/a>&lt;/p>
&lt;p>&lt;strong>&lt;em>假设我们申请的域名的是：&lt;code>example.cc&lt;/code>，编写配置文件时记得替换成自己的。&lt;/em>&lt;/strong>&lt;/p>
&lt;h5 id="配置域名解析">配置域名解析
&lt;/h5>&lt;p>域名解析这里配置两条，把&lt;code>example.cc&lt;/code>和&lt;code>www.example.cc&lt;/code>都指向服务器的地址。
&lt;img src="https://alecthw.github.io/p/v2ray-tutorial/config_server_4.JPG"
width="1402"
height="206"
srcset="https://alecthw.github.io/p/v2ray-tutorial/config_server_4_hu_dd3b65e3cba2a6a4.JPG 480w, https://alecthw.github.io/p/v2ray-tutorial/config_server_4_hu_93cccfe6ef462a89.JPG 1024w"
loading="lazy"
alt="config_server_4"
class="gallery-image"
data-flex-grow="680"
data-flex-basis="1633px"
>&lt;/p>
&lt;p>配置好之后，可以在本地 ping 一下，看看通没通。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ping example.cc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="准备-web-根目录">准备 web 根目录
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>新建目录&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mkdir -p /www/root
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>增加&lt;code>index.html&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vim /www/root/index.html
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>按下&lt;code>i&lt;/code>键到插入模式后，将以下所有内容贴进去。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;!DOCTYPE html&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>404&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">meta&lt;/span> &lt;span class="na">http-equiv&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Content-Type&amp;#34;&lt;/span> &lt;span class="na">content&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text/html&amp;#34;&lt;/span> &lt;span class="na">charset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;UTF-8&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text/javascript&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">charset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;utf-8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">homePageUrl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://www.example.cc/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">homePageName&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;回到我的主页&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="安装配置-nginx">安装配置 Nginx
&lt;/h4>&lt;p>Nginx 安装后，会用到两份配置：&lt;/p>
&lt;ul>
&lt;li>第一份是给第一次申请 Let&amp;rsquo;s Encrypt 的 SSL 证书用的（由于此时还没有证书，配置成 Https）&lt;/li>
&lt;li>第二份是增加了 V2Ray 反代和 Http 重定向 Https 的配置，这个就是一直要用的配置&lt;/li>
&lt;/ul>
&lt;h5 id="安装-nginx">安装 Nginx
&lt;/h5>&lt;p>很简单，一行命令搞定。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">yum install -y nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="编辑nginxconf">编辑&lt;code>nginx.conf&lt;/code>
&lt;/h5>&lt;p>文件&lt;code>/etc/nginx/nginx.conf&lt;/code>。
害怕出错的或者新手请将文件 SFTP 下载到本地，使用 VSCode 修改后再 SFTP 传回服务器。
熟悉 vim 的就直接在命令行修改吧。&lt;/p>
&lt;p>配置文件如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">user&lt;/span> &lt;span class="s">nginx&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">worker_processes&lt;/span> &lt;span class="s">auto&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">error_log&lt;/span> &lt;span class="s">/dev/null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">pid&lt;/span> &lt;span class="s">/run/nginx.pid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">include&lt;/span> &lt;span class="n">/usr/share/nginx/modules/*.conf&lt;/span>;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">events&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">worker_connections&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">http&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">log_format&lt;/span> &lt;span class="s">main&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>&lt;span class="nv">$remote_addr&lt;/span> &lt;span class="s">-&lt;/span> &lt;span class="nv">$remote_user&lt;/span> &lt;span class="s">[&lt;/span>&lt;span class="nv">$time_local]&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$request&amp;#34;&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#39;&lt;/span>&lt;span class="nv">$status&lt;/span> &lt;span class="nv">$body_bytes_sent&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$http_referer&amp;#34;&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#39;&amp;#34;&lt;/span>&lt;span class="nv">$http_user_agent&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">access_log&lt;/span> &lt;span class="no">off&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">sendfile&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">tcp_nopush&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">tcp_nodelay&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">keepalive_timeout&lt;/span> &lt;span class="mi">65&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">types_hash_max_size&lt;/span> &lt;span class="mi">2048&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">include&lt;/span> &lt;span class="s">/etc/nginx/mime.types&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">default_type&lt;/span> &lt;span class="s">application/octet-stream&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">include&lt;/span> &lt;span class="s">/etc/nginx/conf.d/*.conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span> &lt;span class="s">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="s">[::]:80&lt;/span> &lt;span class="s">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">example.cc&lt;/span> &lt;span class="s">www.example.cc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">root&lt;/span> &lt;span class="s">/www/root&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">index&lt;/span> &lt;span class="s">index.html&lt;/span> &lt;span class="s">index.htm&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="启动-nginx-服务">启动 Nginx 服务
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后查看下运行状态是否已经正常启动，看到&lt;code>running&lt;/code>即是正常。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ systemctl status nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">● nginx.service - The nginx HTTP and reverse proxy server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/usr/lib/systemd/system/nginx.service&lt;span class="p">;&lt;/span> enabled&lt;span class="p">;&lt;/span> vendor preset: disabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: active &lt;span class="o">(&lt;/span>running&lt;span class="o">)&lt;/span> since Wed 2018-11-14 11:22:53 CST&lt;span class="p">;&lt;/span> &lt;span class="m">4&lt;/span> days ago
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后打开浏览器访问 &amp;lt;www.example.cc&amp;gt; 和 &amp;lt;example.cc&amp;gt;看是否能打开腾讯公益 404 页面。能打开说明 Nginx 已经正确配置，然后就可以开始申请 SSL 证书了。&lt;/p>
&lt;h4 id="安装-v2ray">安装 V2Ray
&lt;/h4>&lt;p>具体参考&lt;a class="link" href="https://www.v2ray.com/chapter_00/install.html#linuxscript" target="_blank" rel="noopener"
>V2Ray 官方文档&lt;/a>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">bash &amp;lt;&lt;span class="o">(&lt;/span>curl -L -s https://install.direct/go.sh&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完成后自动启动，这里先把它给停了&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl stop v2ray
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="申请-lets-encrypt-的-ssl-证书">申请 Let&amp;rsquo;s Encrypt 的 SSL 证书
&lt;/h4>&lt;p>Let&amp;rsquo;s Encrypt 有很多 ACME 客户端的实现。这里选用&lt;a class="link" href="https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener"
>acme.sh&lt;/a>。&lt;/p>
&lt;h5 id="安装-acmesh">安装 acme.sh
&lt;/h5>&lt;p>安装很简单，一个命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">curl https://get.acme.sh &lt;span class="p">|&lt;/span> sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完成后执行下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">source&lt;/span> /root/.bashrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="申请证书">申请证书
&lt;/h5>&lt;p>很简单，一也是命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">acme.sh --issue -d example.cc -d www.example.cc --webroot /www/root/ -k ec-256
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 ec-256 证书，让通信更安全吧。&lt;/p>
&lt;h5 id="将证书安装到目录">将证书安装到目录
&lt;/h5>&lt;p>这里将证书放到&lt;code>/etx/v2ray&lt;/code>目录下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">acme.sh --installcert -d example.cc -d www.example.cc --key-file /etc/v2ray/v2ray.key --fullchain-file /etc/v2ray/v2ray.crt --ecc --reloadcmd &lt;span class="s2">&amp;#34;service nginx force-reload &amp;amp;&amp;amp; systemctl restart v2ray&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这行命令除了将证书放到指定目录下外，还会自动创建 crontab 定时任务，后面引号里的命令是定时任务更新证书后执行的命令。&lt;/p>
&lt;h4 id="配置-nginx-支持-https-访问">配置 Nginx 支持 Https 访问
&lt;/h4>&lt;p>不废话了，直接修改&lt;code>/etc/nginx/nginx.conf&lt;/code>，完整配置文件如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">user&lt;/span> &lt;span class="s">nginx&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">worker_processes&lt;/span> &lt;span class="s">auto&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">error_log&lt;/span> &lt;span class="s">/dev/null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">pid&lt;/span> &lt;span class="s">/run/nginx.pid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">include&lt;/span> &lt;span class="n">/usr/share/nginx/modules/*.conf&lt;/span>;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">events&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">worker_connections&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">http&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">log_format&lt;/span> &lt;span class="s">main&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>&lt;span class="nv">$remote_addr&lt;/span> &lt;span class="s">-&lt;/span> &lt;span class="nv">$remote_user&lt;/span> &lt;span class="s">[&lt;/span>&lt;span class="nv">$time_local]&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$request&amp;#34;&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#39;&lt;/span>&lt;span class="nv">$status&lt;/span> &lt;span class="nv">$body_bytes_sent&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$http_referer&amp;#34;&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#39;&amp;#34;&lt;/span>&lt;span class="nv">$http_user_agent&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">access_log&lt;/span> &lt;span class="no">off&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_tokens&lt;/span> &lt;span class="no">off&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">sendfile&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">tcp_nopush&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">tcp_nodelay&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">keepalive_timeout&lt;/span> &lt;span class="mi">65&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">types_hash_max_size&lt;/span> &lt;span class="mi">2048&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">include&lt;/span> &lt;span class="s">/etc/nginx/mime.types&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">default_type&lt;/span> &lt;span class="s">application/octet-stream&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">include&lt;/span> &lt;span class="s">/etc/nginx/conf.d/*.conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Http Server，强制跳转Https
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span> &lt;span class="s">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="s">[::]:80&lt;/span> &lt;span class="s">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">example.cc&lt;/span> &lt;span class="s">www.example.cc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">rewrite&lt;/span> &lt;span class="s">^(.*)&lt;/span>$ &lt;span class="s">https://www.example.cc&lt;/span>&lt;span class="nv">$1&lt;/span> &lt;span class="s">permanent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Https Server
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">443&lt;/span> &lt;span class="s">ssl&lt;/span> &lt;span class="s">http2&lt;/span> &lt;span class="s">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="s">[::]:443&lt;/span> &lt;span class="s">ssl&lt;/span> &lt;span class="s">http2&lt;/span> &lt;span class="s">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">www.example.cc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">root&lt;/span> &lt;span class="s">/www/root&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">index&lt;/span> &lt;span class="s">index.html&lt;/span> &lt;span class="s">index.htm&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate&lt;/span> &lt;span class="s">&amp;#34;/etc/v2ray/v2ray.crt&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate_key&lt;/span> &lt;span class="s">&amp;#34;/etc/v2ray/v2ray.key&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_session_cache&lt;/span> &lt;span class="s">shared:SSL:1m&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_session_timeout&lt;/span> &lt;span class="mi">10m&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_ciphers&lt;/span> &lt;span class="s">HIGH:!aNULL:!MD5&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_prefer_server_ciphers&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">include&lt;/span> &lt;span class="s">/etc/nginx/default.d/*.conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 反向代理V2Ray
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="s">/wss&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_redirect&lt;/span> &lt;span class="no">off&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://127.0.0.1:10443&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_http_version&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="s">.1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">&amp;#34;upgrade&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$http_host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">error_page&lt;/span> &lt;span class="mi">404&lt;/span> &lt;span class="s">/404.html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">/40x.html&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">error_page&lt;/span> &lt;span class="mi">500&lt;/span> &lt;span class="mi">502&lt;/span> &lt;span class="mi">503&lt;/span> &lt;span class="mi">504&lt;/span> &lt;span class="s">/50x.html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">/50x.html&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置完之后重新启动 Nginx&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl restart nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>访问 &amp;lt;www.example.cc&amp;gt; 和 &amp;lt;example.cc&amp;gt;，如果自动跳转&lt;code>https://www.example.cc&lt;/code>并且正确显示公益 404 则已经配置正确。&lt;/p>
&lt;h4 id="配置-v2ray-并启动">配置 V2Ray 并启动
&lt;/h4>&lt;p>前置的所有服务都已经配置完毕，只差最后的 V2Ray 了。&lt;/p>
&lt;h5 id="为-v2ray-生成一个-uuid">为 V2Ray 生成一个 UUID
&lt;/h5>&lt;p>使用 V2Ray 自带的&lt;code>v2ctl&lt;/code>工具生成一个新的 uuid。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ /usr/bin/v2ray/v2ctl uuid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">27e0efcc-8e13-fef1-9e82-febebc469b2b
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>记录下此 uuid&lt;/p>
&lt;h5 id="为-mtproto-生成一个密钥">为 mtproto 生成一个密钥
&lt;/h5>&lt;p>使用 linux 系统创建伪随机数作为密钥。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ head -c &lt;span class="m">16&lt;/span> /dev/urandom &lt;span class="p">|&lt;/span> xxd -ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">80e2e037610bac1444ac02979364f666
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>记录下此随机数&lt;/p>
&lt;h5 id="修改etcv2rayconfigjson">修改&lt;code>/etc/v2ray/config.json&lt;/code>
&lt;/h5>&lt;p>同样的，没把握用 vim 修改的，就拷贝下来在 VSCode 里修改，改完再传回服务器。&lt;/p>
&lt;p>将刚生成的 uuid 和随机数填入对应的位置。&lt;/p>
&lt;p>完整配置文件如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;log&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;loglevel&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;none&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;access&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/var/log/v2ray/access.log&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;error&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/var/log/v2ray/error.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;inbounds&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10443&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;listen&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;127.0.0.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;vmess&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;clients&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;27e0efcc-8e13-fef1-9e82-febebc469b2b&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;alterId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;streamSettings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;network&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ws&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;wsSettings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/wss&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;tg-in&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">8080&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;mtproto&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;users&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;secret&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;80e2e037610bac1444ac02979364f666&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outbounds&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;freedom&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;blackhole&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;response&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;none&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;blocked&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;tg-out&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;mtproto&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;routing&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;domainStrategy&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IPOnDemand&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;rules&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;field&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ip&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;geoip:private&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outboundTag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;blocked&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;field&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;inboundTag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;tg-in&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outboundTag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;tg-out&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="启动-v2ray">启动 V2Ray
&lt;/h5>&lt;p>开启开机启动并启动。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> v2ray
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start v2ray
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动之后查看下运行状态，看是否正常运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$systemctl&lt;/span> status v2ray
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">● v2ray.service - V2Ray Service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/etc/systemd/system/v2ray.service&lt;span class="p">;&lt;/span> enabled&lt;span class="p">;&lt;/span> vendor preset: disabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: active &lt;span class="o">(&lt;/span>running&lt;span class="o">)&lt;/span> since Sun 2018-11-18 17:00:07 CST&lt;span class="p">;&lt;/span> 3h 26min ago
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Main PID: &lt;span class="m">8908&lt;/span> &lt;span class="o">(&lt;/span>v2ray&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CGroup: /system.slice/v2ray.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─8908 /usr/bin/v2ray/v2ray -config /etc/v2ray/config.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="客户端配置">客户端配置
&lt;/h2>&lt;p>客户端配置不尽相同，对应客户端详细配置可以自己百度。&lt;/p>
&lt;p>这里用文字描述下大致的配置步骤：&lt;/p>
&lt;ol>
&lt;li>协议类型选择&lt;code>Vmess&lt;/code>，需要和服务端一致&lt;/li>
&lt;li>地址填&lt;code>www.example.cc&lt;/code>，需要和服务端一致&lt;/li>
&lt;li>端口填&lt;code>443&lt;/code>，需要和服务端一致&lt;/li>
&lt;li>UUID 填&lt;code>27e0efcc-8e13-fef1-9e82-febebc469b2b&lt;/code>，需要和服务端一致&lt;/li>
&lt;li>传输协议选择&lt;code>ws&lt;/code>，路径填写&lt;code>/wss&lt;/code>，需要和服务端一致&lt;/li>
&lt;li>开启 TLS&lt;/li>
&lt;li>AlterId 填写&lt;code>64&lt;/code>，需要和服务端一致&lt;/li>
&lt;/ol>
&lt;h3 id="ios-客户端">iOS 客户端
&lt;/h3>&lt;p>iOS 下的 VPN 类客户端在国区基本下架下完了，V2Ray 推荐使用 Kitsunebi 的 TestFlight 版本。&lt;/p>
&lt;ol>
&lt;li>在手机上安装 TestFlight App：&lt;a class="link" href="https://itunes.apple.com/us/app/testflight/id899247664?mt=8" target="_blank" rel="noopener"
>https://itunes.apple.com/us/app/testflight/id899247664?mt=8&lt;/a>&lt;/li>
&lt;li>在手机上打开这个链接自动加入 TestFlight：&lt;a class="link" href="https://testflight.apple.com/join/2w6EF67u" target="_blank" rel="noopener"
>https://testflight.apple.com/join/2w6EF67u&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>&amp;ndash;&amp;gt;&lt;a class="link" href="https://docs.google.com/forms/d/1-1ZuYA1qkyDfAn6qzUzNEV3YVZbgr__7b6aFBiKeNHc/closedform" target="_blank" rel="noopener"
>原文地址&lt;/a>&lt;/p>
&lt;h3 id="其它">其它
&lt;/h3>&lt;p>其它客户端请参考：
&lt;a class="link" href="https://www.v2ray.com/ui_client/windows.html#windows-%E5%AE%A2%E6%88%B7%E7%AB%AF" target="_blank" rel="noopener"
>Windows&lt;/a>
&lt;a class="link" href="https://www.v2ray.com/ui_client/android.html#android-%E5%AE%A2%E6%88%B7%E7%AB%AF" target="_blank" rel="noopener"
>Android&lt;/a>
&lt;a class="link" href="https://www.v2ray.com/ui_client/osx.html#mac-os-x" target="_blank" rel="noopener"
>Mac OS X&lt;/a>&lt;/p>
&lt;h3 id="最后提供两份客户端配置文件">最后提供两份客户端配置文件
&lt;/h3>&lt;p>无需求的以下就可以不看了。&lt;/p>
&lt;h4 id="pc-用的支持国内外分流">PC 用的支持国内外分流
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;inbounds&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1087&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;listen&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;127.0.0.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;http&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;allowTransparent&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1086&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;listen&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;127.0.0.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;socks&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;domainOverride&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;tls&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;http&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;auth&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;noauth&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;udp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outbounds&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;vmess&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;vnext&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;www.example.cc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">443&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;users&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;27e0efcc-8e13-fef1-9e82-febebc469b2b&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;alterId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;security&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;streamSettings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;network&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ws&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;wsSettings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/wss&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;security&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;tls&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mux&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;enabled&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;concurrency&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;proxy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;freedom&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;direct&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;blackhole&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;block&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;log&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;loglevel&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;none&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;access&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;D:/v2ray_access.log&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;error&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;D:/v2ray_error.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dns&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;hosts&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;example.com&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;127.0.0.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;servers&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;223.5.5.5&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;8.8.8.8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;localhost&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;routing&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;strategy&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;rules&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;domainStrategy&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IPIfNonMatch&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;rules&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;field&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;domain&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dropbox&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;github&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;google&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;instagram&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;netflix&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;pinterest&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;pixiv&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;tumblr&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;twitter&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:facebook.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:fbcdn.net&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:fivecdm.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:ggpht.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:gstatic.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:line-scdn.net&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:line.me&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:medium.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:naver.jp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:pximg.net&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:t.co&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:twimg.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:youtube.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:ytimg.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outboundTag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;proxy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;field&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ip&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;125.209.222.0/24&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;149.154.167.0/24&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;149.154.175.0/24&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;91.108.56.0/24&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outboundTag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;proxy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;field&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;domain&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;cctv&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;geosite:cn&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;umeng&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:apple.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:crashlytics.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:icloud.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:ixigua.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:pstatp.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:snssdk.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;domain:toutiao.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outboundTag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;direct&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;field&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ip&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;geoip:cn&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;geoip:private&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outboundTag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;direct&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;field&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;domain&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;domain:doubleclick.net&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outboundTag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;block&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="路由器用的透明代理">路由器用的，透明代理
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;inbounds&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7070&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dokodemo-door&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;domainOverride&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;tls&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;http&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;network&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;tcp,udp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timeout&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;followRedirect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;outbounds&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;vmess&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;settings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;vnext&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;www.example.cc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">443&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;users&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;27e0efcc-8e13-fef1-9e82-febebc469b2b&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;alterId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;security&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;streamSettings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;network&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ws&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;wsSettings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/wss&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;security&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;tls&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mux&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;enabled&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;log&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;loglevel&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;none&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;access&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;error&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dns&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;servers&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;localhost&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>归档</title><link>https://alecthw.github.io/archives/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://alecthw.github.io/archives/</guid><description/></item><item><title>链接</title><link>https://alecthw.github.io/links/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://alecthw.github.io/links/</guid><description>&lt;p>To use this feature, add &lt;code>links&lt;/code> section to frontmatter.&lt;/p>
&lt;p>This page&amp;rsquo;s frontmatter:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">links&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GitHub&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GitHub is the world&amp;#39;s largest software development platform.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">website&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://github.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TypeScript&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TypeScript is a typed superset of JavaScript that compiles to plain JavaScript.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">website&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://www.typescriptlang.org&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ts-logo-128.jpg&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>image&lt;/code> field accepts both local and external images.&lt;/p></description></item><item><title>书籍</title><link>https://alecthw.github.io/book/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://alecthw.github.io/book/</guid><description>&lt;h2 id="说明">说明
&lt;/h2>&lt;p>书籍归档，包括自己原创和收集来的。&lt;/p>
&lt;h3 id="收集来的">收集来的
&lt;/h3>&lt;ul>
&lt;li>&lt;a class="link" href="https://alecthw.github.io/books/markdown-simple-world/index.html" >Markdown·简单的世界&lt;/a> (&lt;a class="link" href="https://wizardforcel.gitbooks.io/markdown-simple-world/content/" target="_blank" rel="noopener"
>原文地址&lt;/a>)&lt;/li>
&lt;/ul>
&lt;h3 id="个人原创">个人原创
&lt;/h3></description></item><item><title>搜索</title><link>https://alecthw.github.io/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://alecthw.github.io/search/</guid><description/></item></channel></rss>